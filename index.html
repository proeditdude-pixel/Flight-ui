<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CX_IFE_V14_ULTIMATE</title>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;300;400;500;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

<style>
  /* --- 1. GLOBAL VARIABLES & RESET --- */
  :root {
    /* IDENTITY - Overwritten by Settings */
    --primary: #006564;  
    --accent: #C3A676;
    
    /* SYSTEM PALETTE */
    --bg-dark: #050505;
    --bg-panel: #121212;
    --bg-card: #1a1a1a;
    --border: #333;
    --text-main: #f0f0f0;
    --text-muted: #888;
    
    /* FONTS */
    --sans: 'Outfit', sans-serif;
    --serif: 'Playfair Display', serif;
    
    /* DIMENSIONS */
    --sidebar-w: 90px;
    --player-h: 70px;
  }

  * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
  
  body { 
    margin: 0; background: var(--bg-dark); color: var(--text-main); 
    font-family: var(--sans); height: 100vh; overflow: hidden; 
  }

  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: #111; }
  ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

  /* --- 2. WELCOME / BOARDING PASS SCREEN --- */
  #welcome_layer {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: radial-gradient(circle at center, #222 0%, #000 100%);
    z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
    transition: 0.8s ease-in-out;
  }
  #welcome_layer.off { opacity: 0; pointer-events: none; transform: scale(1.05); }

  .pass-card {
    width: 340px; background: #fff; color: #000; border-radius: 20px; overflow: hidden;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5); position: relative;
    transform: rotate(-2deg); transition: 0.5s; cursor: pointer;
  }
  .pass-card:hover { transform: rotate(0deg) scale(1.02); }
  .pass-header { background: var(--primary); padding: 20px; display: flex; justify-content: space-between; align-items: center; }
  .pass-logo { height: 30px; filter: brightness(0) invert(1); }
  .pass-body { padding: 25px; }
  .pass-row { display: flex; justify-content: space-between; margin-bottom: 20px; }
  .pass-label { font-size: 10px; color: #666; text-transform: uppercase; letter-spacing: 1px; }
  .pass-val { font-size: 20px; font-weight: 700; color: #222; font-family: var(--sans); }
  .pass-route { font-size: 32px; font-weight: 800; color: var(--primary); letter-spacing: 2px; }
  .pass-footer { background: #f4f4f4; padding: 15px; text-align: center; font-size: 11px; color: #888; letter-spacing: 2px; border-top: 1px dashed #ccc; }
  
  .tap-hint { margin-top: 40px; color: #666; animation: pulse 2s infinite; font-size: 12px; letter-spacing: 3px; text-transform: uppercase; }
  @keyframes pulse { 0%,100%{opacity:0.4} 50%{opacity:1} }

  /* --- 3. APP STRUCTURE --- */
  #app_container {
    display: flex; height: 100%; width: 100%; opacity: 0; 
    transform: scale(0.98); transition: 1s ease; pointer-events: none;
  }
  #app_container.on { opacity: 1; transform: scale(1); pointer-events: all; }

  #app_bg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-size: cover; background-position: center; opacity: 0.2; z-index: -1;
    transition: background-image 0.5s;
  }

  /* SIDEBAR */
  .sidebar {
    width: var(--sidebar-w); background: rgba(10,10,10,0.9); border-right: 1px solid var(--border);
    display: flex; flex-direction: column; align-items: center; backdrop-filter: blur(15px); z-index: 100;
  }
  .brand-box { 
    width: 100%; height: 90px; display: flex; justify-content: center; align-items: center;
    background: var(--primary); margin-bottom: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.3);
  }
  .brand-logo { width: 50px; object-fit: contain; filter: brightness(0) invert(1); }

  .nav-item {
    width: 100%; padding: 18px 0; text-align: center; color: #666; cursor: pointer;
    border-left: 3px solid transparent; transition: 0.2s; position: relative;
  }
  .nav-item i { font-size: 20px; margin-bottom: 5px; display: block; transition: 0.2s; }
  .nav-item span { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
  .nav-item:hover { color: #fff; background: rgba(255,255,255,0.05); }
  .nav-item.active { 
    color: var(--accent); border-left-color: var(--accent); 
    background: linear-gradient(90deg, rgba(255,255,255,0.08), transparent); 
  }
  .nav-item.active i { transform: scale(1.1); text-shadow: 0 0 10px var(--accent); }

  /* MAIN AREA */
  .main-content { flex: 1; display: flex; flex-direction: column; position: relative; }

  /* HEADER */
  .top-bar {
    height: 80px; display: flex; align-items: center; justify-content: space-between; padding: 0 40px;
    background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
  }
  .flight-route { font-family: var(--serif); font-size: 24px; font-style: italic; }
  .flight-route b { color: var(--accent); font-family: var(--sans); font-style: normal; margin: 0 10px; }
  .flight-timer { text-align: right; }
  .flight-timer div:first-child { font-size: 10px; color: var(--text-muted); letter-spacing: 1px; }
  .flight-timer div:last-child { font-size: 20px; font-weight: 300; color: #fff; }

  /* VIEWS CONTAINER */
  .viewport { flex: 1; position: relative; overflow-y: auto; padding: 20px 40px 100px 40px; }
  .view { display: none; animation: slideUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); }
  .view.active { display: block; }
  @keyframes slideUp { from{opacity:0; transform:translateY(20px)} to{opacity:1; transform:translateY(0)} }

  /* TYPOGRAPHY */
  h1 { font-family: var(--serif); font-weight: 400; font-size: 38px; color: var(--accent); margin: 0 0 5px 0; }
  h2 { font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); margin: 0 0 30px 0; border-bottom: 1px solid #333; padding-bottom: 10px; display: inline-block; }

  /* --- VIEW: HOME (DASHBOARD) --- */
  .dash-grid { display: grid; grid-template-columns: 1.5fr 1fr 1fr; gap: 20px; height: 400px; }
  
  .card-3d-map {
    grid-column: 1 / 2; grid-row: 1 / 3; background: #000; border-radius: 12px; border: 1px solid #333;
    position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center;
  }
  /* Pure CSS Globe */
  .globe { width: 280px; height: 280px; border-radius: 50%; background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Earthmap1000x500compac.jpg/1000px-Earthmap1000x500compac.jpg'); background-size: cover; box-shadow: inset -40px -40px 80px rgba(0,0,0,0.9); animation: rotate 60s linear infinite; position: relative; }
  @keyframes rotate { from{background-position: 0 0;} to{background-position: -400% 0;} }
  .globe-shadow { position: absolute; width: 100%; height: 100%; border-radius: 50%; box-shadow: inset 0 0 40px rgba(0,0,0,0.8); z-index: 2; }
  .plane-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); color: var(--accent); font-size: 40px; z-index: 5; text-shadow: 0 10px 20px black; }

  .card-stat { background: var(--bg-card); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; justify-content: center; border-left: 3px solid var(--primary); }
  .stat-val { font-size: 32px; font-weight: 300; }
  .stat-lbl { font-size: 11px; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-top: 5px; }

  /* --- VIEW: MAP (SVG) --- */
  .map-container { width: 100%; height: 500px; background: #0d131a; border-radius: 16px; border: 1px solid #333; position: relative; overflow: hidden; }
  .svg-map { width: 100%; height: 100%; opacity: 0.6; }
  .city-dot { fill: #fff; }
  .city-label { fill: #888; font-size: 10px; font-family: var(--sans); }
  .route-path { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 2; }
  .route-progress { fill: none; stroke: var(--accent); stroke-width: 2; stroke-dasharray: 1000; stroke-dashoffset: 1000; transition: stroke-dashoffset 1s linear; filter: drop-shadow(0 0 5px var(--accent)); }
  .map-plane-svg { font-size: 20px; fill: #fff; filter: drop-shadow(0 0 10px var(--accent)); transition: all 1s linear; }

  /* --- VIEW: ENTERTAINMENT & SHOP --- */
  .tabs { display: flex; gap: 20px; margin-bottom: 20px; border-bottom: 1px solid #333; }
  .tab { padding: 10px 0; color: #666; cursor: pointer; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
  .tab.active { color: #fff; border-bottom: 2px solid var(--accent); }

  .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
  .media-item { 
    background: #111; border-radius: 6px; overflow: hidden; transition: 0.3s; 
    cursor: pointer; position: relative;
  }
  .media-item:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
  .media-poster { width: 100%; height: 220px; object-fit: cover; opacity: 0.8; }
  .media-info { padding: 10px; }
  .media-title { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .media-genre { font-size: 10px; color: var(--accent); text-transform: uppercase; margin-top: 3px; }

  .shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
  .shop-item { background: #fff; color: #000; border-radius: 8px; overflow: hidden; padding-bottom: 10px; }
  .shop-img { width: 100%; height: 180px; object-fit: contain; padding: 20px; background: #fff; }
  .shop-details { padding: 0 15px; }
  .shop-name { font-weight: 700; font-size: 14px; margin-bottom: 5px; }
  .shop-price { color: var(--primary); font-weight: 600; }
  .shop-btn { width: 90%; margin: 10px auto 0; display: block; padding: 8px; background: #000; color: #fff; border: none; cursor: pointer; font-size: 11px; text-transform: uppercase; }
  .shop-btn:hover { background: var(--accent); }

  /* --- VIEW: DINE --- */
  .menu-section { margin-bottom: 40px; }
  .menu-head { font-family: var(--serif); font-size: 22px; color: #fff; font-style: italic; border-bottom: 1px solid #333; margin-bottom: 15px; padding-bottom: 5px; }
  .dish { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); }
  .dish:last-child { border: none; }
  .dish-info h4 { margin: 0; font-size: 16px; font-weight: 500; }
  .dish-info p { margin: 5px 0 0 0; color: #888; font-size: 12px; }
  .add-btn { background: transparent; border: 1px solid #444; color: #fff; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; transition: 0.2s; }
  .add-btn:hover { background: var(--accent); border-color: var(--accent); color: #000; }

  /* --- VIEW: CHAT & CREW --- */
  .chat-ui { display: flex; height: 500px; border: 1px solid #333; border-radius: 10px; overflow: hidden; background: rgba(0,0,0,0.5); }
  .chat-window { flex: 2; display: flex; flex-direction: column; border-right: 1px solid #333; }
  .chat-msgs { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
  .bubble { padding: 10px 15px; border-radius: 10px; max-width: 70%; font-size: 13px; line-height: 1.4; }
  .bubble.them { background: #222; align-self: flex-start; }
  .bubble.me { background: var(--primary); align-self: flex-end; color: #fff; }
  .bubble.cpt { background: #fff; color: #000; align-self: center; text-align: center; border: 2px solid var(--accent); width: 80%; font-family: var(--serif); font-style: italic; }
  
  .chat-input-area { padding: 15px; background: #111; display: flex; border-top: 1px solid #333; }
  .chat-input { flex: 1; background: #222; border: none; color: #fff; padding: 10px; border-radius: 4px; outline: none; }
  .send-btn { background: var(--accent); color: #000; border: none; padding: 0 20px; margin-left: 10px; border-radius: 4px; font-weight: bold; cursor: pointer; }

  .quick-actions { flex: 1; padding: 20px; background: #0a0a0a; display: flex; flex-direction: column; gap: 10px; }
  .q-btn { padding: 15px; background: #1a1a1a; border: 1px solid #333; color: #ccc; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
  .q-btn:hover { border-color: var(--accent); color: #fff; background: #222; }

  /* --- 4. PERSISTENT MUSIC PLAYER --- */
  .music-bar {
    position: absolute; bottom: 0; left: var(--sidebar-w); width: calc(100% - var(--sidebar-w));
    height: var(--player-h); background: #111; border-top: 1px solid #333;
    display: flex; align-items: center; padding: 0 20px; z-index: 500;
  }
  .track-info { display: flex; align-items: center; width: 300px; }
  .track-art { width: 40px; height: 40px; background: #333; margin-right: 15px; background-size: cover; }
  .track-meta div:first-child { font-size: 13px; font-weight: bold; color: #fff; }
  .track-meta div:last-child { font-size: 11px; color: var(--accent); }
  .player-ctrls { flex: 1; display: flex; justify-content: center; gap: 20px; font-size: 18px; color: #ccc; }
  .player-ctrls i { cursor: pointer; transition: 0.2s; }
  .player-ctrls i:hover { color: #fff; }
  
  /* --- 5. SETTINGS OVERLAY --- */
  .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:2000; display:none; justify-content:center; align-items:center; backdrop-filter:blur(5px); }
  .modal-box { width:500px; background:#111; border:1px solid var(--primary); padding:30px; border-radius:10px; max-height:90vh; overflow-y:auto; }
  .st-group { margin-bottom: 20px; }
  .st-label { font-size:10px; color:var(--accent); text-transform:uppercase; display:block; margin-bottom:5px; font-weight:bold; letter-spacing:1px; }
  .st-input { width:100%; background:#000; border:1px solid #333; color:#fff; padding:10px; margin-bottom:5px; border-radius:4px; }
  
  /* --- 6. TOAST NOTIFICATION --- */
  .toast { position: fixed; bottom: 90px; right: 20px; background: #fff; color: #000; padding: 15px 25px; border-radius: 50px; transform: translateY(100px); transition: 0.3s; z-index: 3000; font-weight: bold; box-shadow: 0 5px 20px rgba(0,0,0,0.5); display: flex; align-items: center; gap: 10px; }
  .toast.show { transform: translateY(0); }
  .toast i { color: var(--primary); }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    #app_container { flex-direction: column-reverse; }
    .sidebar { width: 100%; height: 60px; flex-direction: row; justify-content: space-around; border-right: none; border-top: 1px solid #333; }
    .brand-box { display: none; }
    .nav-item { border-left: none; border-top: 2px solid transparent; padding: 0; display: flex; flex-direction: column; justify-content: center; height: 100%; }
    .nav-item.active { border-top-color: var(--accent); background: transparent; }
    .music-bar { bottom: 60px; left: 0; width: 100%; height: 50px; }
    .top-bar { padding: 0 20px; }
    .dash-grid { grid-template-columns: 1fr; height: auto; }
    .card-3d-map { grid-column: auto; height: 300px; }
    .viewport { padding: 20px; padding-bottom: 120px; }
  }
</style>
</head>
<body>

<div id="welcome_layer" onclick="bootSystem()">
  <div class="pass-card">
    <div class="pass-header">
      <img id="pass_logo" class="pass-logo" src="">
      <span style="font-size:10px; color:rgba(255,255,255,0.7); text-transform:uppercase">Business Class</span>
    </div>
    <div class="pass-body">
      <div class="pass-row">
        <div>
          <div class="pass-label">Passenger</div>
          <div class="pass-val">V14 GUEST</div>
        </div>
        <div style="text-align:right">
          <div class="pass-label">Seat</div>
          <div class="pass-val" id="pass_seat">--</div>
        </div>
      </div>
      <div class="pass-row">
        <div>
          <div class="pass-label">From</div>
          <div class="pass-route" id="pass_og">HKG</div>
        </div>
        <div style="display:flex; align-items:center; color:#ccc"><i class="fas fa-plane"></i></div>
        <div style="text-align:right">
          <div class="pass-label">To</div>
          <div class="pass-route" id="pass_ds">LHR</div>
        </div>
      </div>
      <div class="pass-row" style="margin-bottom:0">
         <div>
          <div class="pass-label">Flight</div>
          <div class="pass-val">CX 255</div>
        </div>
        <div style="text-align:right">
          <div class="pass-label">Date</div>
          <div class="pass-val" id="pass_date">--</div>
        </div>
      </div>
    </div>
    <div class="pass-footer">TOUCH TO INITIALIZE SEAT SYSTEM</div>
  </div>
  <div class="tap-hint">System Standby</div>
</div>

<div id="app_container">
  <div id="app_bg"></div>

  <div class="sidebar">
    <div class="brand-box"><img id="ui_logo" class="brand-logo" src=""></div>
    <div class="nav-item active" onclick="nav('view_home', this)"><i class="fas fa-home"></i><span>Home</span></div>
    <div class="nav-item" onclick="nav('view_map', this)"><i class="fas fa-map-marked-alt"></i><span>Map</span></div>
    <div class="nav-item" onclick="nav('view_media', this)"><i class="fas fa-play"></i><span>Ent</span></div>
    <div class="nav-item" onclick="nav('view_dine', this)"><i class="fas fa-utensils"></i><span>Dine</span></div>
    <div class="nav-item" onclick="nav('view_shop', this)"><i class="fas fa-shopping-bag"></i><span>Shop</span></div>
    <div class="nav-item" onclick="nav('view_chat', this)"><i class="fas fa-comment-dots"></i><span>Crew</span></div>
    <div class="nav-item" onclick="openSettings()"><i class="fas fa-sliders-h"></i><span>Set</span></div>
  </div>

  <div class="main-content">
    <div class="top-bar">
      <div class="flight-route"><span id="top_og">HKG</span> <b>&mdash;</b> <span id="top_ds">LHR</span></div>
      <div class="flight-timer">
        <div>TIME TO DESTINATION</div>
        <div id="top_rem">--:--</div>
      </div>
    </div>

    <div class="viewport">
      
      <div id="view_home" class="view active">
        <h1>Flight Dashboard</h1>
        <h2>Live Telemetry</h2>
        <div class="dash-grid">
          <div class="card-3d-map">
            <div class="globe"><div class="globe-shadow"></div></div>
            <i class="fas fa-plane plane-icon"></i>
          </div>
          <div class="card-stat">
            <div class="stat-val">912 <span style="font-size:16px">km/h</span></div>
            <div class="stat-lbl">Ground Speed</div>
          </div>
          <div class="card-stat">
            <div class="stat-val">34,000 <span style="font-size:16px">ft</span></div>
            <div class="stat-lbl">Altitude</div>
          </div>
          <div class="card-stat">
            <div class="stat-val">-51 &deg;C</div>
            <div class="stat-lbl">Outside Temp</div>
          </div>
           <div class="card-stat">
            <div class="stat-val" id="stat_dist">--</div>
            <div class="stat-lbl">Distance Left</div>
          </div>
        </div>
      </div>

      <div id="view_map" class="view">
        <h1>Flight Path</h1>
        <h2>Global Positioning</h2>
        <div class="map-container">
          <svg class="svg-map" viewBox="0 0 1000 500">
             <path fill="#2c3e50" d="M150,100 Q200,50 250,100 T350,150 T500,100 T700,150 T900,100 V400 H100 V100 Z" opacity="0.5"/> 
             <path id="route_path" d="M200,250 Q500,100 800,250" class="route-path" />
             <path id="route_prog" d="M200,250 Q500,100 800,250" class="route-progress" />
             <circle cx="200" cy="250" r="3" class="city-dot"/><text x="200" y="270" text-anchor="middle" class="city-label" id="svg_og">ORG</text>
             <circle cx="800" cy="250" r="3" class="city-dot"/><text x="800" y="270" text-anchor="middle" class="city-label" id="svg_ds">DST</text>
             <g id="svg_plane"><path d="M0,0 L10,-5 L10,5 Z" class="map-plane-svg" transform="scale(1.5)"/></g>
          </svg>
        </div>
      </div>

      <div id="view_media" class="view">
        <h1>Entertainment</h1>
        <h2>StudioCX On Demand</h2>
        <div class="tabs">
          <div class="tab active" onclick="tab('mov')">Movies</div>
          <div class="tab" onclick="tab('tv')">TV Shows</div>
          <div class="tab" onclick="tab('aud')">Audio</div>
          <div class="tab" onclick="tab('game')">Games</div>
        </div>
        
        <div id="tab_mov" class="media-grid"></div> </div>

      <div id="view_dine" class="view">
        <h1>In-flight Dining</h1>
        <h2>A La Carte</h2>
        
        <div class="menu-section">
          <div class="menu-head">Starters</div>
          <div id="menu_starters"></div>
        </div>
        <div class="menu-section">
          <div class="menu-head">Main Course</div>
          <div id="menu_mains"></div>
        </div>
        <div class="menu-section">
          <div class="menu-head">Beverages</div>
          <div id="menu_drinks"></div>
        </div>
      </div>

      <div id="view_shop" class="view">
        <h1>Duty Free</h1>
        <h2>Shopping Collection</h2>
        <div class="shop-grid" id="shop_container"></div>
      </div>

      <div id="view_chat" class="view">
        <h1>Crew Connect</h1>
        <h2>Seat <span id="chat_seat_id">--</span></h2>
        <div class="chat-ui">
          <div class="chat-window">
            <div class="chat-msgs" id="chat_box"></div>
            <div class="chat-input-area">
              <input class="chat-input" id="msg_in" placeholder="Message crew...">
              <button class="send-btn" onclick="sendMsg()">SEND</button>
            </div>
          </div>
          <div class="quick-actions">
            <div class="q-btn" onclick="req('Water')"><i class="fas fa-glass-water"></i> Water</div>
            <div class="q-btn" onclick="req('Coffee')"><i class="fas fa-coffee"></i> Coffee</div>
            <div class="q-btn" onclick="req('Duty Free')"><i class="fas fa-shopping-bag"></i> Shop Help</div>
            <div class="q-btn" onclick="req('Medical')"><i class="fas fa-briefcase-medical"></i> Medical</div>
          </div>
        </div>
      </div>

    </div> </div> <div class="music-bar">
    <div class="track-info">
      <div class="track-art" id="m_art"></div>
      <div class="track-meta">
        <div id="m_title">Select Track</div>
        <div id="m_artist">StudioCX</div>
      </div>
    </div>
    <div class="player-ctrls">
      <i class="fas fa-step-backward" onclick="prevTrack()"></i>
      <i class="fas fa-play" id="play_btn" onclick="togglePlay()"></i>
      <i class="fas fa-step-forward" onclick="nextTrack()"></i>
    </div>
    <div style="width:100px; text-align:right; color:#666; font-size:11px">AUDIO ON</div>
  </div>

</div>

<div class="modal-overlay" id="set_modal">
  <div class="modal-box">
    <h3 style="color:var(--accent); border-bottom:1px solid #333; padding-bottom:10px;">SYSTEM CONTROL</h3>
    
    <div class="st-group">
      <span class="st-label">Visual Theme</span>
      <div style="display:flex; gap:10px">
        <input type="color" id="set_c1" class="st-input" style="padding:0; height:40px; cursor:pointer">
        <input type="color" id="set_c2" class="st-input" style="padding:0; height:40px; cursor:pointer">
      </div>
    </div>

    <div class="st-group">
      <span class="st-label">Airline Branding</span>
      <input id="set_lg" class="st-input" placeholder="Logo URL">
      <input id="set_bg" class="st-input" placeholder="Background URL">
    </div>

    <div class="st-group">
      <span class="st-label">Flight Data</span>
      <div style="display:flex; gap:10px">
        <input id="set_og" class="st-input" placeholder="ORG">
        <input id="set_ds" class="st-input" placeholder="DST">
      </div>
      <input id="set_dur" class="st-input" type="number" placeholder="Duration (min)">
    </div>
    
    <div class="st-group">
      <span class="st-label">Captain's Announcement</span>
      <input id="set_anno" class="st-input" placeholder="Send message to all screens...">
      <button class="shop-btn" style="width:100%; margin-top:5px" onclick="sendCaptainMsg()">BROADCAST</button>
    </div>

    <button class="shop-btn" style="width:100%; padding:15px; background:var(--primary); font-size:14px;" onclick="saveConfig()">APPLY & RESTART</button>
    <button class="shop-btn" style="width:100%; background:#333; margin-top:10px" onclick="closeSettings()">CLOSE</button>
  </div>
</div>

<div class="modal-overlay" id="vid_modal" style="background:#000;">
  <div style="position:absolute; top:20px; right:20px; color:#fff; font-size:40px; cursor:pointer; z-index:99" onclick="closeVid()">&times;</div>
  <iframe id="vid_frame" style="width:100%; height:100%; border:none" allow="autoplay"></iframe>
</div>

<div class="toast" id="toast"><i class="fas fa-check-circle"></i> <span id="toast_msg">Action Success</span></div>

<script>
// --- CONFIGURATION ---
const C = { apiKey: "AIzaSyBiabDx61thAOm_A-_2x_mC9Nb9gArRCns", authDomain: "flight-ui.firebaseapp.com", projectId: "flight-ui", appId: "1:507585547506:web:a2f401ddda5055b59ed46b" };

// --- DATASETS ---
const DB_MOVIES = [
  {t:"Top Gun: Maverick", g:"Action", i:"https://upload.wikimedia.org/wikipedia/en/1/13/Top_Gun_Maverick_Poster.jpg", u:"https://www.youtube.com/embed/qSqVVzvW13s?autoplay=1"},
  {t:"Avatar: The Way of Water", g:"Sci-Fi", i:"https://upload.wikimedia.org/wikipedia/en/5/54/Avatar_The_Way_of_Water_poster.jpg", u:"https://www.youtube.com/embed/d9MyqF3bPhI?autoplay=1"},
  {t:"Oppenheimer", g:"Drama", i:"https://upload.wikimedia.org/wikipedia/en/4/4a/Oppenheimer_%28film%29.jpg", u:"https://www.youtube.com/embed/uYPbbksJxIg?autoplay=1"},
  {t:"The Super Mario Bros", g:"Family", i:"https://upload.wikimedia.org/wikipedia/en/4/44/The_Super_Mario_Bros._Movie_poster.jpg", u:"https://www.youtube.com/embed/TnGl01FkMMo?autoplay=1"}
];

const DB_MENU = {
  starters: [
    {n:"Smoked Salmon", d:"Served with capers, lemon and rye bread.", p:"$12"},
    {n:"Truffle Soup", d:"Wild mushroom with truffle oil.", p:"$10"}
  ],
  mains: [
    {n:"Wagyu Beef Burger", d:"Brioche bun, aged cheddar, fries.", p:"$24"},
    {n:"Lobster Thermidor", d:"Creamy cheese sauce, asparagus.", p:"$38"},
    {n:"Miso Cod", d:"Japanese style black cod with rice.", p:"$32"}
  ],
  drinks: [
    {n:"Champagne", d:"Krug Grande CuvÃ©e", p:"$25"},
    {n:"Signature Cocktail", d:"Gin, Basil, Lemon", p:"$15"}
  ]
};

const DB_SHOP = [
  {n:"Chanel No. 5", p:"$145", i:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/Chanel_No_5_parfum.jpg/440px-Chanel_No_5_parfum.jpg"},
  {n:"Ray-Ban Aviator", p:"$180", i:"https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Ray_Ban_Aviator_Sunglasses.jpg/500px-Ray_Ban_Aviator_Sunglasses.jpg"},
  {n:"Johnnie Walker Blue", p:"$220", i:"https://upload.wikimedia.org/wikipedia/commons/e/e0/Johnnie_Walker_Blue_Label.jpg"}
];

const DB_AUDIO = [
  {t:"Lofi Study", a:"Chillhop", c:"#55efc4"},
  {t:"Jazz Vibes", a:"Blue Note", c:"#ffeaa7"},
  {t:"Ambient Sky", a:"Brian Eno", c:"#74b9ff"}
];

const DEF = {
  c1: "#006564", c2: "#C3A676",
  lg: "https://upload.wikimedia.org/wikipedia/en/thumb/9/96/Cathay_Pacific_logo.svg/1200px-Cathay_Pacific_logo.svg.png",
  bg: "https://images.unsplash.com/photo-1542296332-2e44a996aa0b?q=80&w=2000&auto=format&fit=crop",
  og: "HKG", ds: "LHR"
};

let db, ref, chatRef;
let mySeat = "";
let simTimer;
let currentTrack = 0;
let isPlaying = false;

// --- INITIALIZATION ---
function init() {
  firebase.initializeApp(C);
  db = firebase.database();
  ref = db.ref('v14_sys');
  chatRef = db.ref('v14_chat');
  
  genSeat();
  renderContent();
  setupListeners();
  
  document.getElementById('pass_date').innerText = new Date().toLocaleDateString();
}

// --- RENDERING CONTENT ---
function renderContent() {
  // Movies
  document.getElementById('tab_mov').innerHTML = DB_MOVIES.map(m => `
    <div class="media-item" onclick="playVid('${m.u}')">
      <img src="${m.i}" class="media-poster">
      <div class="media-info"><div class="media-title">${m.t}</div><div class="media-genre">${m.g}</div></div>
    </div>
  `).join('');
  
  // Menu
  const mkDish = (i) => `<div class="dish"><div class="dish-info"><h4>${i.n}</h4><p>${i.d}</p></div><button class="add-btn" onclick="order('${i.n}')">+</button></div>`;
  document.getElementById('menu_starters').innerHTML = DB_MENU.starters.map(mkDish).join('');
  document.getElementById('menu_mains').innerHTML = DB_MENU.mains.map(mkDish).join('');
  document.getElementById('menu_drinks').innerHTML = DB_MENU.drinks.map(mkDish).join('');
  
  // Shop
  document.getElementById('shop_container').innerHTML = DB_SHOP.map(s => `
    <div class="shop-item">
      <img src="${s.i}" class="shop-img">
      <div class="shop-details">
        <div class="shop-name">${s.n}</div>
        <div class="shop-price">${s.p}</div>
        <button class="shop-btn" onclick="order('Duty Free: ${s.n}')">ADD TO CART</button>
      </div>
    </div>
  `).join('');
}

// --- SYSTEM LOGIC ---
function setupListeners() {
  ref.on('value', snap => {
    const d = snap.val();
    if(d) applyConfig(d);
  });
  
  chatRef.limitToLast(20).on('child_added', snap => {
    const v = snap.val();
    const box = document.getElementById('chat_box');
    const isMe = v.u === mySeat;
    const isCpt = v.type === 'cpt';
    let cls = isCpt ? 'cpt' : (isMe ? 'me' : 'them');
    
    box.innerHTML += `<div class="bubble ${cls}">${isCpt?'<b>CAPTAIN SPEAKING</b><br>':''} ${v.m}</div>`;
    box.scrollTop = box.scrollHeight;
    
    if(isCpt) showToast("Captain Announcement Received");
  });
}

function applyConfig(d) {
  // Colors
  const r = document.documentElement;
  r.style.setProperty('--primary', d.c1 || DEF.c1);
  r.style.setProperty('--accent', d.c2 || DEF.c2);
  
  // Images
  document.getElementById('ui_logo').src = d.lg || DEF.lg;
  document.getElementById('pass_logo').src = d.lg || DEF.lg;
  document.getElementById('app_bg').style.backgroundImage = `url('${d.bg || DEF.bg}')`;
  
  // Text
  document.getElementById('pass_og').innerText = d.og || DEF.og; document.getElementById('top_og').innerText = d.og || DEF.og; document.getElementById('svg_og').innerText = d.og || DEF.og;
  document.getElementById('pass_ds').innerText = d.ds || DEF.ds; document.getElementById('top_ds').innerText = d.ds || DEF.ds; document.getElementById('svg_ds').innerText = d.ds || DEF.ds;

  // Settings Sync
  document.getElementById('set_c1').value = d.c1 || DEF.c1;
  document.getElementById('set_c2').value = d.c2 || DEF.c2;
  document.getElementById('set_lg').value = d.lg || "";
  document.getElementById('set_bg').value = d.bg || "";
  document.getElementById('set_og').value = d.og || "";
  document.getElementById('set_ds').value = d.ds || "";
  document.getElementById('set_dur').value = d.dur || 60;

  if(d.start && d.dur) runSim(d.start, d.dur);
}

function runSim(start, dur) {
  if(simTimer) clearInterval(simTimer);
  simTimer = setInterval(() => {
    const now = Date.now();
    const elapsed = now - start;
    const total = dur * 60000;
    let pct = elapsed / total;
    if(pct > 1) pct = 1;
    if(pct < 0) pct = 0;
    
    // SVG Path Animation
    const len = document.getElementById('route_path').getTotalLength();
    const draw = len * pct;
    document.getElementById('route_prog').style.strokeDashoffset = len - draw;
    
    // Plane on Path Logic (simplified bezier estimate)
    const p = document.getElementById('route_path').getPointAtLength(draw);
    const plane = document.getElementById('svg_plane');
    // Basic rotation logic: look ahead 1px
    const pNext = document.getElementById('route_path').getPointAtLength(draw + 1);
    const angle = Math.atan2(pNext.y - p.y, pNext.x - p.x) * 180 / Math.PI;
    
    plane.setAttribute("transform", `translate(${p.x},${p.y}) rotate(${angle}) scale(1.5)`);
    
    // Data Stats
    const minLeft = Math.ceil((total - elapsed)/60000);
    document.getElementById('top_rem').innerText = `${Math.floor(minLeft/60)}h ${minLeft%60}m`;
    document.getElementById('stat_dist').innerText = Math.floor(9000 * (1-pct)) + " km";
    
  }, 1000);
}

// --- USER ACTIONS ---
function genSeat() {
  if(!localStorage.getItem('v14_seat')) {
    const r = Math.floor(Math.random()*50)+1;
    const c = ['A','K','D','G'][Math.floor(Math.random()*4)];
    localStorage.setItem('v14_seat', r+c);
  }
  mySeat = localStorage.getItem('v14_seat');
  document.getElementById('pass_seat').innerText = mySeat;
  document.getElementById('chat_seat_id').innerText = mySeat;
}

function bootSystem() {
  document.getElementById('welcome_layer').classList.add('off');
  document.getElementById('app_container').classList.add('on');
}

function nav(id, el) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  if(el) el.classList.add('active');
}

function playVid(u) {
  document.getElementById('vid_modal').style.display = 'block';
  document.getElementById('vid_frame').src = u;
}
function closeVid() {
  document.getElementById('vid_modal').style.display = 'none';
  document.getElementById('vid_frame').src = "";
}

function order(item) {
  chatRef.push({ u: mySeat, m: `[ORDER] ${item}` });
  showToast("Order Sent to Galley");
}

function req(type) {
  chatRef.push({ u: mySeat, m: `[REQUEST] ${type}` });
  showToast("Crew Notified: " + type);
}

function sendMsg() {
  const i = document.getElementById('msg_in');
  if(i.value) {
    chatRef.push({ u: mySeat, m: i.value });
    i.value = "";
  }
}

function showToast(msg) {
  const t = document.getElementById('toast');
  document.getElementById('toast_msg').innerText = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// --- AUDIO PLAYER ---
function togglePlay() {
  const btn = document.getElementById('play_btn');
  if(isPlaying) {
    btn.classList.remove('fa-pause'); btn.classList.add('fa-play');
    isPlaying = false;
  } else {
    btn.classList.remove('fa-play'); btn.classList.add('fa-pause');
    isPlaying = true;
    updateTrackDisplay();
  }
}
function nextTrack() {
  currentTrack = (currentTrack + 1) % DB_AUDIO.length;
  updateTrackDisplay();
}
function prevTrack() {
  currentTrack = (currentTrack - 1 + DB_AUDIO.length) % DB_AUDIO.length;
  updateTrackDisplay();
}
function updateTrackDisplay() {
  const t = DB_AUDIO[currentTrack];
  document.getElementById('m_title').innerText = t.t;
  document.getElementById('m_artist').innerText = t.a;
  document.getElementById('m_art').style.background = t.c;
}

// --- SETTINGS ADMIN ---
function openSettings() { document.getElementById('set_modal').style.display = 'flex'; }
function closeSettings() { document.getElementById('set_modal').style.display = 'none'; }
function saveConfig() {
  ref.set({
    c1: document.getElementById('set_c1').value,
    c2: document.getElementById('set_c2').value,
    lg: document.getElementById('set_lg').value,
    bg: document.getElementById('set_bg').value,
    og: document.getElementById('set_og').value,
    ds: document.getElementById('set_ds').value,
    dur: document.getElementById('set_dur').value,
    start: Date.now()
  });
  closeSettings();
}
function sendCaptainMsg() {
  const m = document.getElementById('set_anno').value;
  if(m) chatRef.push({ u: "CAPTAIN", m: m, type: "cpt" });
  document.getElementById('set_anno').value = "";
  showToast("Broadcast Sent");
}

// Start
window.onload = init;
</script>
</body>
</html>
