<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CX_IFE_V11_ULTIMATE</title>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
  /* --- THEME VARIABLES --- */
  :root {
    --cx-teal: #006564;
    --cx-sand: #C3A676;
    --bg: #000000;
    --panel: #141414;
    --txt: #ffffff;
    --card-bg: #1a1a1a;
    --font: 'Noto Sans HK', sans-serif;
  }

  body { margin: 0; background: var(--bg); color: var(--txt); font-family: var(--font); height: 100vh; overflow: hidden; }
  
  /* --- 1. WELCOME / STANDBY LAYER --- */
  #welcome_layer {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: radial-gradient(circle at center, #1a2a30 0%, #000000 90%);
    z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
    transition: opacity 0.8s ease, transform 0.8s ease, visibility 0.8s;
    cursor: pointer;
  }
  #welcome_layer.off { opacity: 0; transform: scale(1.1); visibility: hidden; pointer-events: none; }
  
  .wel-logo { font-size: 60px; color: var(--cx-teal); margin-bottom: 20px; filter: drop-shadow(0 0 20px rgba(0,101,100,0.5)); }
  .wel-title { font-size: 32px; font-weight: 300; letter-spacing: 2px; text-transform: uppercase; color: #fff; }
  .wel-seat { font-size: 18px; color: var(--cx-sand); margin-top: 10px; font-weight: 600; letter-spacing: 1px; }
  .wel-hint { margin-top: 50px; font-size: 12px; color: #666; animation: pulse 2s infinite; text-transform: uppercase; letter-spacing: 2px; }
  @keyframes pulse { 0%{opacity:0.3} 50%{opacity:1} 100%{opacity:0.3} }

  /* --- 2. MAIN APP CONTAINER --- */
  #app_container {
    display: flex; height: 100%; width: 100%; opacity: 0; transition: opacity 1s ease;
    transform: scale(0.98); pointer-events: none;
  }
  #app_container.on { opacity: 1; transform: scale(1); pointer-events: all; }

  /* Dynamic Background */
  #app_bg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-size: cover; background-position: center; opacity: 0.3; z-index: -1;
    transition: background-image 0.5s;
  }

  /* Sidebar */
  .sidebar {
    width: 80px; background: rgba(10,10,10,0.95); border-right: 1px solid #333; z-index: 100;
    display: flex; flex-direction: column; align-items: center; backdrop-filter: blur(10px);
  }
  .logo-box { width: 100%; padding: 20px 0; display: flex; justify-content: center; background: var(--cx-teal); margin-bottom: 20px; }
  .logo-img { width: 40px; height: 40px; object-fit: contain; filter: brightness(0) invert(1); }
  
  .nav-btn {
    width: 100%; padding: 18px 0; text-align: center; color: #666; cursor: pointer; border-left: 3px solid transparent; transition: 0.2s;
  }
  .nav-btn i { font-size: 20px; display: block; margin-bottom: 5px; }
  .nav-btn span { font-size: 9px; text-transform: uppercase; font-weight: 600; letter-spacing: 1px; }
  .nav-btn:hover { color: #fff; background: rgba(255,255,255,0.05); }
  .nav-btn.active { color: var(--cx-sand); border-left-color: var(--cx-sand); background: linear-gradient(90deg, rgba(195,166,118,0.1), transparent); }
  
  .pwr-btn { margin-top: auto; margin-bottom: 20px; color: #d63031; opacity: 0.7; }
  .pwr-btn:hover { opacity: 1; color: #ff7675; text-shadow: 0 0 10px #d63031; }

  /* Main Area */
  .main { flex: 1; display: flex; flex-direction: column; position: relative; }

  /* Header */
  .header {
    height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 40px;
    background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
  }
  .route-disp { font-size: 24px; font-weight: 300; }
  .route-disp b { font-weight: 600; color: var(--cx-sand); }
  
  /* View Port */
  .view-port { flex: 1; position: relative; overflow-y: auto; overflow-x: hidden; padding: 20px 40px; }
  .view { display: none; animation: fadeUp 0.5s ease; padding-bottom: 50px; }
  .view.active { display: block; }
  @keyframes fadeUp { from{opacity:0; transform:translateY(20px)} to{opacity:1; transform:translateY(0)} }

  h1 { font-weight: 300; color: var(--cx-sand); margin-bottom: 5px; }
  h2 { font-size: 16px; text-transform: uppercase; color: #666; margin-top: 0; margin-bottom: 20px; letter-spacing: 2px; }

  /* --- VIEW 1: HOME (3D EARTH) --- */
  .hero-section { display: flex; align-items: center; justify-content: space-around; height: 50%; margin-bottom: 20px; }
  .globe-container {
    width: 280px; height: 280px; border-radius: 50%;
    background: #000; box-shadow: inset -40px -40px 100px rgba(0,0,0,0.9), 0 0 50px rgba(0,100,100,0.2);
    position: relative; overflow: hidden; border: 1px solid #333;
  }
  .earth-texture {
    width: 200%; height: 100%;
    background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Earthmap1000x500compac.jpg/1000px-Earthmap1000x500compac.jpg');
    background-size: cover; animation: spin 30s linear infinite; opacity: 0.8;
  }
  @keyframes spin { from{transform:translateX(0)} to{transform:translateX(-50%)} }
  .hero-plane {
    position: absolute; top: 50%; left: 50%; font-size: 40px; color: var(--cx-sand);
    transform: translate(-50%, -50%) rotate(-45deg);
    text-shadow: 0 10px 20px rgba(0,0,0,1); z-index: 10;
  }

  .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
  .stat-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; border-top: 2px solid var(--cx-teal); }
  .stat-val { font-size: 28px; font-weight: 300; }
  .stat-label { font-size: 11px; text-transform: uppercase; color: #888; margin-top: 5px; }

  /* --- VIEW 2: MAP --- */
  .map-wrapper { 
    width: 100%; height: 500px; border-radius: 12px; overflow: hidden; position: relative; 
    background: #0b1116; border: 1px solid #333; display: flex; justify-content: center; align-items: center;
  }
  .map-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }
  .route-line-bg { position: absolute; top: 50%; left: 10%; right: 10%; height: 2px; background: rgba(255,255,255,0.1); }
  .route-line-fill { position: absolute; top: 50%; left: 10%; height: 2px; background: var(--cx-sand); width: 0%; transition: width 1s linear; }
  .map-plane { 
    position: absolute; top: 50%; left: 10%; 
    font-size: 24px; color: #fff; transform: translate(-50%, -50%) rotate(90deg); 
    transition: left 1s linear; filter: drop-shadow(0 0 10px var(--cx-sand));
  }
  .map-labels { position: absolute; top: 55%; width: 80%; left: 10%; display: flex; justify-content: space-between; font-size: 12px; color: #aaa; }

  /* --- VIEW 3: WATCH/GAMES (GRID) --- */
  .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
  .media-card { 
    background: var(--card-bg); border-radius: 4px; overflow: hidden; cursor: pointer; 
    transition: 0.3s; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 1px solid transparent;
  }
  .media-card:hover { transform: translateY(-5px); border-color: var(--cx-sand); }
  .media-card img { width: 100%; height: 260px; object-fit: cover; opacity: 0.9; }
  .media-meta { padding: 12px; }
  .media-title { font-size: 14px; font-weight: 500; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .media-sub { font-size: 10px; color: var(--cx-sand); margin-top: 4px; text-transform: uppercase; }

  /* --- VIEW 4: DINE (MENU) --- */
  .menu-list { background: #151515; padding: 20px; border-radius: 8px; border: 1px solid #333; }
  .menu-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #333; }
  .menu-item:last-child { border: none; }
  .dish-name { font-size: 15px; font-weight: 500; }
  .dish-desc { font-size: 12px; color: #888; margin-top: 4px; width: 80%; }
  .dish-tag { font-size: 10px; border: 1px solid var(--cx-teal); color: var(--cx-teal); padding: 2px 6px; border-radius: 2px; height: fit-content; }
  
  /* --- VIEW 5: CHAT --- */
  .chat-box { height: 400px; background: rgba(0,0,0,0.3); border: 1px solid #333; border-radius: 8px; display: flex; flex-direction: column; }
  .msgs { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
  .msg { padding: 8px 12px; border-radius: 6px; background: #222; max-width: 80%; font-size: 13px; align-self: flex-start; }
  .msg.me { background: var(--cx-teal); align-self: flex-end; color: #fff; }
  .msg b { color: var(--cx-sand); font-size: 10px; display: block; margin-bottom: 2px; }
  .chat-ctrl { display: flex; padding: 10px; border-top: 1px solid #333; }
  .chat-ctrl input { flex: 1; background: #111; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 4px; }
  .chat-ctrl button { margin-left: 10px; background: var(--cx-sand); border: none; padding: 0 20px; font-weight: bold; cursor: pointer; color: #000; border-radius: 4px; }

  /* --- MODALS --- */
  .admin-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000;
    display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px);
  }
  .admin-box { width: 400px; background: #1a1a1a; padding: 30px; border-radius: 10px; border: 1px solid var(--cx-teal); }
  .inp { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 10px; margin-bottom: 10px; box-sizing: border-box; }
  .btn { width: 100%; padding: 12px; background: var(--cx-teal); color: #fff; border: none; cursor: pointer; font-weight: bold; margin-top: 10px; }
  
  .vid-modal { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:3000; display:none; }
  .close-vid { position:absolute; top:20px; right:20px; color:#fff; font-size:30px; cursor:pointer; z-index:3001; background:rgba(0,0,0,0.5); padding:10px; border-radius:50%; }
  iframe { border:none; width:100%; height:100%; }

  /* --- MOBILE --- */
  @media (max-width: 768px) {
    #app_container { flex-direction: column-reverse; }
    .sidebar { width: 100%; height: 65px; flex-direction: row; justify-content: space-around; padding: 0; border-right: none; border-top: 1px solid #333; }
    .logo-box, .pwr-btn span { display: none; }
    .pwr-btn { margin: 0; padding: 0 15px; color: #d63031; }
    .nav-btn { border-left: none; border-top: 3px solid transparent; padding: 0; height: 100%; display: flex; flex-direction: column; justify-content: center; width: 100%; }
    .nav-btn.active { border-top-color: var(--cx-sand); background: transparent; }
    .view-port { padding: 15px; }
    .header { padding: 0 20px; }
    .globe-container { width: 200px; height: 200px; }
    .stats-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div id="welcome_layer" onclick="powerOn()">
  <i class="fas fa-feather-alt wel-logo"></i>
  <div class="wel-title">Welcome Onboard</div>
  <div class="wel-seat" id="wel_seat_disp">Seat --</div>
  <div class="wel-hint">Tap screen to wake up</div>
</div>

<div id="app_container">
  <div id="app_bg"></div>

  <div class="sidebar">
    <div class="logo-box"><img id="ui_logo" class="logo-img" src=""></div>
    <div class="nav-btn active" onclick="nav('home', this)"><i class="fas fa-globe-asia"></i><span>Flight</span></div>
    <div class="nav-btn" onclick="nav('map', this)"><i class="fas fa-map"></i><span>Map</span></div>
    <div class="nav-btn" onclick="nav('watch', this)"><i class="fas fa-film"></i><span>Watch</span></div>
    <div class="nav-btn" onclick="nav('dine', this)"><i class="fas fa-utensils"></i><span>Dine</span></div>
    <div class="nav-btn" onclick="nav('chat', this)"><i class="fas fa-comments"></i><span>Crew</span></div>
    <div class="nav-btn" onclick="openSet()"><i class="fas fa-sliders-h"></i><span>Set</span></div>
    
    <div class="nav-btn pwr-btn" onclick="powerOff(event)"><i class="fas fa-power-off"></i><span>Off</span></div>
  </div>

  <div class="main">
    <div class="header">
      <div class="route-disp"><span id="ui_og">ORG</span> <i class="fas fa-plane" style="font-size:16px; margin:0 10px; color:#666"></i> <span id="ui_ds">DST</span></div>
      <div style="text-align:right">
        <div style="font-size:12px; color:#888;">TIME REMAINING</div>
        <div style="font-size:18px; color:var(--cx-sand)" id="ui_rem">--:--</div>
      </div>
    </div>

    <div class="view-port">
      
      <div id="home" class="view active">
        <h1>Flight Status</h1>
        <div class="hero-section">
          <div class="globe-container">
            <div class="earth-texture"></div>
            <i class="fas fa-plane hero-plane"></i>
          </div>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label"><i class="fas fa-tachometer-alt"></i> Ground Speed</div>
            <div class="stat-val">945 <span style="font-size:14px">km/h</span></div>
          </div>
          <div class="stat-card">
            <div class="stat-label"><i class="fas fa-cloud-sun"></i> Weather at Dest</div>
            <div class="stat-val" id="ui_wea">22&deg;C <span style="font-size:14px">Sunny</span></div>
          </div>
          <div class="stat-card">
            <div class="stat-label"><i class="fas fa-ruler-horizontal"></i> Distance Left</div>
            <div class="stat-val" id="ui_dist">0 <span style="font-size:14px">km</span></div>
          </div>
        </div>
      </div>

      <div id="map" class="view">
        <h1>Live Tracking</h1>
        <div class="map-wrapper">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/World_map_blank_without_borders.svg/2000px-World_map_blank_without_borders.svg.png" class="map-img">
          <div class="route-line-bg"></div>
          <div class="route-line-fill" id="map_line"></div>
          <i class="fas fa-plane map-plane" id="map_plane"></i>
          <div class="map-labels">
            <span id="map_og">ORG</span>
            <span id="map_ds">DST</span>
          </div>
        </div>
      </div>

      <div id="watch" class="view">
        <h1>StudioCX</h1>
        <h2>Latest Blockbusters</h2>
        <div class="media-grid" id="mov_grid"></div>
        <h2 style="margin-top:40px">Interactive Games</h2>
        <div class="media-grid" id="game_grid"></div>
      </div>

      <div id="dine" class="view">
        <h1>A la Carte</h1>
        <h2>Business Class Menu</h2>
        <div class="menu-list">
          <div class="menu-item">
             <div><div class="dish-name">Wagyu Beef Burger</div><div class="dish-desc">Brioche bun, cheddar, caramelized onions, fries.</div></div>
             <div class="dish-tag">MAIN</div>
          </div>
          <div class="menu-item">
             <div><div class="dish-name">Wonton Noodle Soup</div><div class="dish-desc">Shrimp dumplings, egg noodles, supreme broth.</div></div>
             <div class="dish-tag">SNACK</div>
          </div>
          <div class="menu-item">
             <div><div class="dish-name">Matcha Cheesecake</div><div class="dish-desc">Japanese green tea, red bean paste.</div></div>
             <div class="dish-tag">DESSERT</div>
          </div>
        </div>
        <button class="btn" onclick="callCrew('Ordering Food')">CALL ATTENDANT TO ORDER</button>
      </div>

      <div id="chat" class="view">
        <h1>Crew & Passenger Link</h1>
        <h2>Connected as <span id="chat_seat_display">--</span></h2>
        <div class="chat-box">
          <div class="msgs" id="chat_msgs"></div>
          <div class="chat-ctrl">
            <input id="chat_in" placeholder="Type message...">
            <button onclick="sendMsg()">SEND</button>
          </div>
        </div>
        <div style="margin-top:20px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
          <button class="btn" style="background:#333" onclick="callCrew('Requesting Water')"><i class="fas fa-glass-water"></i> WATER</button>
          <button class="btn" style="background:#333" onclick="callCrew('Requesting Assistance')"><i class="fas fa-bell"></i> ASSIST</button>
        </div>
      </div>

    </div>
  </div>
</div>

<div class="admin-overlay" id="adm">
  <div class="admin-box">
    <h3 style="margin-top:0; color:var(--cx-sand)">FLIGHT SETTINGS</h3>
    <label style="font-size:10px; color:#888;">LOGO URL</label><input class="inp" id="s_lg">
    <label style="font-size:10px; color:#888;">BACKGROUND URL</label><input class="inp" id="s_bg">
    <div style="display:flex; gap:10px;">
      <div><label style="font-size:10px; color:#888;">ORIGIN</label><input class="inp" id="s_og"></div>
      <div><label style="font-size:10px; color:#888;">DESTINATION</label><input class="inp" id="s_ds"></div>
    </div>
    <label style="font-size:10px; color:#888;">FLIGHT DURATION (MIN)</label>
    <input class="inp" type="number" id="s_dur" placeholder="e.g. 60">
    <button class="btn" onclick="saveSettings()">START SIMULATION</button>
    <button class="btn" style="background:#333; margin-top:5px" onclick="closeSet()">CLOSE</button>
  </div>
</div>

<div class="vid-modal" id="vid_modal">
  <div class="close-vid" onclick="closeVid()">&times;</div>
  <iframe id="vid_frame" allow="autoplay; fullscreen"></iframe>
</div>

<script>
// --- CONFIG & DATA ---
const C = { apiKey: "AIzaSyBiabDx61thAOm_A-_2x_mC9Nb9gArRCns", authDomain: "flight-ui.firebaseapp.com", projectId: "flight-ui", appId: "1:507585547506:web:a2f401ddda5055b59ed46b" };

const DATA = {
  movies: [
    {t:"Top Gun: Maverick", g:"Action", i:"https://upload.wikimedia.org/wikipedia/en/1/13/Top_Gun_Maverick_Poster.jpg", u:"https://www.youtube.com/embed/qSqVVzvW13s?autoplay=1"},
    {t:"The Fabelmans", g:"Drama", i:"https://upload.wikimedia.org/wikipedia/en/2/23/The_Fabelmans_poster.jpg", u:"https://www.youtube.com/embed/D1G2iLSzOe8?autoplay=1"},
    {t:"Avatar 2", g:"Sci-Fi", i:"https://upload.wikimedia.org/wikipedia/en/5/54/Avatar_The_Way_of_Water_poster.jpg", u:"https://www.youtube.com/embed/d9MyqF3bPhI?autoplay=1"}
  ],
  games: [
    {t:"2048", g:"Puzzle", i:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/2048_logo.svg/220px-2048_logo.svg.png", u:"https://play2048.co/"},
    {t:"Minecraft", g:"Adventure", i:"https://upload.wikimedia.org/wikipedia/en/5/51/Minecraft_cover.png", u:"https://classic.minecraft.net/"}
  ]
};

const DEF_LOGO = "https://upload.wikimedia.org/wikipedia/en/thumb/9/96/Cathay_Pacific_logo.svg/1200px-Cathay_Pacific_logo.svg.png";
const DEF_BG = "https://images.unsplash.com/photo-1542296332-2e44a996aa0b?q=80&w=2000&auto=format&fit=crop";

let db, ref, chatRef;
let simInterval;
let mySeat = "";

function init(){
  try {
    firebase.initializeApp(C);
    db = firebase.database();
    ref = db.ref('v11_flight');
    chatRef = db.ref('v11_chat');

    assignSeat();
    renderMedia();
    listen();
  } catch(e) { console.log(e); }
}

// --- LOGIC: SEAT & POWER ---
function assignSeat() {
  let s = localStorage.getItem("v11_seat");
  if(!s) {
    s = (Math.floor(Math.random()*60)+1) + ["A","C","D","G","H","K"][Math.floor(Math.random()*6)];
    localStorage.setItem("v11_seat", s);
  }
  mySeat = s;
  document.getElementById('wel_seat_disp').innerText = "Seat " + mySeat;
  document.getElementById('chat_seat_display').innerText = mySeat;
}

function powerOn() {
  document.getElementById('welcome_layer').classList.add('off');
  document.getElementById('app_container').classList.add('on');
}

function powerOff(e) {
  e.stopPropagation();
  document.getElementById('app_container').classList.remove('on');
  document.getElementById('welcome_layer').classList.remove('off');
}

// --- LOGIC: CONTENT RENDER ---
function renderMedia() {
  document.getElementById('mov_grid').innerHTML = DATA.movies.map(m=>`
    <div class="media-card" onclick="play('${m.u}')">
      <img src="${m.i}">
      <div class="media-meta"><div class="media-title">${m.t}</div><div class="media-sub">${m.g}</div></div>
    </div>`).join('');
  document.getElementById('game_grid').innerHTML = DATA.games.map(g=>`
    <div class="media-card" onclick="play('${g.u}')">
      <img src="${g.i}">
      <div class="media-meta"><div class="media-title">${g.t}</div><div class="media-sub">${g.g}</div></div>
    </div>`).join('');
}

// --- LOGIC: LISTENERS & SIMULATION ---
function listen(){
  ref.on('value', snap => {
    let v = snap.val();
    if(v) updateUI(v);
  });
  
  chatRef.limitToLast(20).on('child_added', snap=>{
    let v = snap.val();
    let box = document.getElementById('chat_msgs');
    let isMe = v.u === mySeat;
    box.innerHTML += `<div class="msg ${isMe?'me':''}"><b>${v.u}</b>${v.m}</div>`;
    box.scrollTop = box.scrollHeight;
  });
}

function updateUI(data){
  // Visuals
  document.getElementById('ui_logo').src = data.lg || DEF_LOGO;
  document.getElementById('app_bg').style.backgroundImage = `url('${data.bg || DEF_BG}')`;
  
  // Routes
  document.getElementById('ui_og').innerText = data.og || "HKG";
  document.getElementById('ui_ds').innerText = data.ds || "LHR";
  document.getElementById('map_og').innerText = data.og || "HKG";
  document.getElementById('map_ds').innerText = data.ds || "LHR";

  // Admin Inputs
  document.getElementById('s_lg').value = data.lg || "";
  document.getElementById('s_bg').value = data.bg || "";
  document.getElementById('s_og').value = data.og || "";
  document.getElementById('s_ds').value = data.ds || "";
  document.getElementById('s_dur').value = data.dur || 60;

  // Simulation
  if(data.start && data.dur) runSimulation(data.start, data.dur);
}

function runSimulation(startTime, durationMins) {
  if(simInterval) clearInterval(simInterval);
  simInterval = setInterval(() => {
    let now = Date.now();
    let elapsed = now - startTime;
    let total = durationMins * 60 * 1000;
    
    let pct = (elapsed / total) * 100;
    if(pct > 100) pct = 100;
    if(pct < 0) pct = 0;

    // Map Updates
    document.getElementById('map_line').style.width = pct + "%";
    document.getElementById('map_plane').style.left = (10 + pct*0.8) + "%"; 

    // Text Updates
    let minsLeft = Math.ceil((total - elapsed) / 1000 / 60);
    if(minsLeft < 0) minsLeft = 0;
    let hours = Math.floor(minsLeft / 60);
    let mins = minsLeft % 60;
    document.getElementById('ui_rem').innerText = `${hours}h ${mins}m`;

    let distTotal = 9000;
    let distLeft = Math.floor(distTotal * (1 - (pct/100)));
    document.getElementById('ui_dist').innerText = distLeft;

    if(pct > 80) document.getElementById('ui_wea').innerHTML = "12&deg;C <small>Rainy</small>";
    else document.getElementById('ui_wea').innerHTML = "24&deg;C <small>Sunny</small>";
  }, 1000);
}

// --- ACTIONS ---
function saveSettings(){
  let d = {
    lg: document.getElementById('s_lg').value || DEF_LOGO,
    bg: document.getElementById('s_bg').value || DEF_BG,
    og: document.getElementById('s_og').value || "HKG",
    ds: document.getElementById('s_ds').value || "LHR",
    dur: parseInt(document.getElementById('s_dur').value) || 60,
    start: Date.now()
  };
  ref.set(d);
  closeSet();
}

function sendMsg(){
  let i = document.getElementById('chat_in');
  if(!i.value) return;
  chatRef.push({u:mySeat, m:i.value});
  i.value = "";
}

function callCrew(reason){
  chatRef.push({u:mySeat, m:` [SERVICE] ${reason}`});
  alert("Crew notified!");
}

function nav(id, el){
  document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));
  el.classList.add('active');
}

function play(u){ document.getElementById('vid_modal').style.display='block'; document.getElementById('vid_frame').src=u; }
function closeVid(){ document.getElementById('vid_modal').style.display='none'; document.getElementById('vid_frame').src=""; }
function openSet(){ document.getElementById('adm').style.display = "flex"; }
function closeSet(){ document.getElementById('adm').style.display = "none"; }

window.onload = init;
</script>
</body>
</html>
