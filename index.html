<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>InFlight V40 | CX Edition</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500;700&family=Playfair+Display:ital,wght@0,500;0,600;0,700;1,500&display=swap" rel="stylesheet">

    <style>
        /* ==========================================================================
           1. THEME VARIABLES & RESET
           ========================================================================== */
        :root {
            /* BRANDING COLORS (CX TEAL DEFAULT) */
            --hue: 178; 
            --primary: #005E63;
            --primary-dark: #004448;
            --primary-light: #007A80;
            --accent: #C6A87C; /* Gold Accent */
            
            /* LAYOUT DIMENSIONS */
            --bar-h: 90px;
            --head-h: 70px;
            --nav-w: 280px;
            
            /* SURFACES */
            --bg-body: #F4F6F8;
            --bg-card: #FFFFFF;
            --bg-glass: rgba(255, 255, 255, 0.85);
            --bg-input: #EFF2F5;
            --bg-sidebar: #FFFFFF;
            
            /* TYPOGRAPHY COLORS */
            --tx-main: #1D1D1F;
            --tx-dim: #6E6E73;
            --tx-inv: #FFFFFF;

            /* UTILITIES */
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-lg: 0 12px 40px rgba(0,0,0,0.08);
            --border: 1px solid rgba(0,0,0,0.08);
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --trans: 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        /* DARK MODE OVERRIDES */
        body.dark-mode {
            --bg-body: #050505;
            --bg-card: #151515;
            --bg-glass: rgba(20, 20, 20, 0.8);
            --bg-input: #252525;
            --bg-sidebar: #101010;
            --tx-main: #F5F5F7;
            --tx-dim: #86868B;
            --border: 1px solid rgba(255,255,255,0.08);
            --primary: #007A80; /* Lighter teal for dark mode */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        
        body {
            margin: 0; padding: 0;
            font-family: 'Inter', sans-serif;
            background: var(--bg-body); color: var(--tx-main);
            width: 100vw; height: 100vh; overflow: hidden;
            transition: background 0.5s ease, color 0.5s ease;
        }

        /* TYPOGRAPHY CLASSES */
        .f-serif { font-family: 'Playfair Display', serif; }
        .f-mono { font-family: 'JetBrains Mono', monospace; }
        
        h1 { font-size: 32px; font-weight: 700; margin: 0 0 10px 0; letter-spacing: -0.5px; }
        h2 { font-size: 24px; font-weight: 600; margin: 0 0 20px 0; }
        h3 { font-size: 18px; font-weight: 600; margin: 0 0 10px 0; }
        p { line-height: 1.6; color: var(--tx-dim); margin: 0; font-size: 15px; }

        /* ==========================================================================
           2. COMPONENT LIBRARY
           ========================================================================== */
        
        /* FLEXBOX UTILS */
        .flex { display: flex; align-items: center; }
        .flex-c { display: flex; align-items: center; justify-content: center; }
        .flex-col { display: flex; flex-direction: column; }
        .flex-sb { display: flex; align-items: center; justify-content: space-between; }
        .gap-2 { gap: 10px; } .gap-3 { gap: 15px; } .gap-4 { gap: 20px; }
        .w-full { width: 100%; }
        .abs-fill { position: absolute; inset: 0; }

        /* BUTTONS */
        .btn {
            height: 48px; padding: 0 24px; border-radius: var(--radius-sm); border: none;
            font-size: 14px; font-weight: 600; cursor: pointer; transition: var(--trans);
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            letter-spacing: 0.5px; text-transform: uppercase;
        }
        .btn-primary { 
            background: var(--primary); color: white; 
            box-shadow: 0 4px 15px rgba(0, 94, 99, 0.2); 
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 94, 99, 0.3); }
        .btn-primary:active { transform: translateY(0); }
        
        .btn-sec { background: var(--bg-input); color: var(--tx-main); border: var(--border); }
        .btn-sec:hover { background: rgba(0,0,0,0.05); }

        .btn-danger { background: rgba(255, 59, 48, 0.1); color: #FF3B30; }
        .btn-danger:hover { background: #FF3B30; color: white; }

        .btn-icon {
            width: 40px; height: 40px; border-radius: 50%; border: none;
            background: transparent; color: var(--tx-dim); cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .btn-icon:hover { background: var(--bg-input); color: var(--primary); }
        .btn-icon svg { width: 20px; height: 20px; fill: currentColor; }

        /* CARDS */
        .card {
            background: var(--bg-card); border-radius: var(--radius-md);
            padding: 24px; border: var(--border); box-shadow: var(--shadow-sm);
            margin-bottom: 24px; position: relative; overflow: hidden;
            transition: var(--trans);
        }
        
        /* INPUTS */
        .input-group { margin-bottom: 20px; }
        .label { display: block; font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--tx-dim); margin-bottom: 8px; letter-spacing: 1px; }
        .input {
            width: 100%; height: 50px; padding: 0 16px; border-radius: var(--radius-sm);
            background: var(--bg-input); border: var(--border);
            color: var(--tx-main); font-family: inherit; font-size: 15px;
            transition: 0.2s;
        }
        .input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(var(--hue), 100%, 50%, 0.1); }

        .file-upload {
            border: 2px dashed rgba(0,0,0,0.1); border-radius: var(--radius-sm);
            height: 100px; display: flex; flex-direction: column; align-items: center;
            justify-content: center; color: var(--tx-dim); cursor: pointer;
            background: var(--bg-input); transition: 0.2s; position: relative;
        }
        .file-upload:hover { border-color: var(--primary); color: var(--primary); background: rgba(0, 94, 99, 0.05); }
        .file-upload input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }

        /* ==========================================================================
           3. MAIN LAYOUT STRUCTURE
           ========================================================================== */
        
        #app { display: flex; width: 100%; height: 100%; opacity: 0; transition: opacity 1s ease; }
        #app.booted { opacity: 1; }

        /* SIDEBAR (Desktop Only) */
        #sidebar {
            width: var(--nav-w); background: var(--bg-sidebar); border-right: var(--border);
            display: flex; flex-direction: column; z-index: 50; padding-bottom: var(--bar-h);
        }
        .brand { height: 100px; display: flex; align-items: center; padding: 0 25px; gap: 15px; border-bottom: var(--border); }
        .brand-logo { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; }
        .brand-logo img { width: 100%; height: 100%; object-fit: contain; }
        .brand-text { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 700; color: var(--primary); }

        .nav-list { flex: 1; padding: 30px 15px; overflow-y: auto; }
        .nav-item {
            display: flex; align-items: center; gap: 15px; padding: 14px 20px;
            border-radius: 12px; margin-bottom: 5px; cursor: pointer;
            color: var(--tx-dim); font-weight: 500; transition: 0.2s;
        }
        .nav-item:hover { background: var(--bg-input); color: var(--tx-main); }
        .nav-item.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .nav-item svg { width: 22px; height: 22px; fill: currentColor; }

        /* STAGE */
        #stage { flex: 1; display: flex; flex-direction: column; position: relative; background: var(--bg-body); }
        
        /* HEADER */
        #header {
            height: var(--head-h); padding: 0 40px; display: flex; align-items: center;
            justify-content: space-between; position: relative; z-index: 10;
        }
        .route-pill {
            background: var(--bg-card); padding: 8px 24px; border-radius: 100px;
            box-shadow: var(--shadow-sm); display: flex; align-items: center; gap: 15px; border: var(--border);
        }

        /* VIEWPORT */
        #viewport {
            flex: 1; position: relative; overflow: hidden;
            /* Account for bottom bar */
            padding-bottom: var(--bar-h);
        }
        
        /* PAGES */
        .page {
            position: absolute; inset: 0; padding: 10px 40px 120px 40px;
            overflow-y: auto; overflow-x: hidden; opacity: 0; 
            transform: translateY(20px); pointer-events: none;
            transition: 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .page.active { opacity: 1; transform: translateY(0); pointer-events: all; }
        
        /* SCROLLBAR HIDE */
        .page::-webkit-scrollbar { width: 6px; }
        .page::-webkit-scrollbar-track { background: transparent; }
        .page::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }

        /* ==========================================================================
           4. BOTTOM CONTROL BAR (THE MAIN REQUIREMENT)
           ========================================================================== */
        #bottom-bar {
            position: absolute; bottom: 0; left: 0; width: 100%; height: var(--bar-h);
            background: var(--bg-glass); backdrop-filter: blur(25px);
            border-top: var(--border); z-index: 100;
            display: flex; align-items: center; justify-content: center; gap: 80px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.05);
        }

        .bar-btn {
            display: flex; flex-direction: column; align-items: center; gap: 8px;
            background: none; border: none; cursor: pointer; color: var(--tx-dim);
            transition: 0.3s; position: relative; width: 90px;
        }
        .bar-btn svg { width: 26px; height: 26px; fill: currentColor; transition: 0.3s; }
        .bar-btn span { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        
        .bar-btn::after {
            content: ''; position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; border-radius: 50%; background: var(--primary);
            opacity: 0; transition: 0.3s;
        }

        .bar-btn:hover { color: var(--primary); }
        .bar-btn.active { color: var(--primary); }
        .bar-btn.active::after { opacity: 1; }
        
        .bar-btn.home svg { width: 32px; height: 32px; } /* Larger Home Icon */

        /* ==========================================================================
           5. SYSTEM OVERLAYS (BOOT, LOCK, OFF)
           ========================================================================== */
        .overlay {
            position: fixed; inset: 0; z-index: 9000; background: #000; color: #fff;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        
        /* BOOT SCREEN */
        #boot-screen { align-items: flex-start; padding: 60px; font-family: 'JetBrains Mono', monospace; font-size: 13px; z-index: 9999; }
        .boot-row { margin-bottom: 4px; opacity: 0; animation: fadeIn 0.05s forwards; display: flex; gap: 10px; }
        .boot-ts { color: #666; }
        .boot-msg { color: #ddd; }
        .boot-ok { color: #22c55e; font-weight: 700; }
        @keyframes fadeIn { to { opacity: 1; } }

        /* SHUTDOWN */
        #off-screen { background: #000; opacity: 0; pointer-events: none; transition: 1.5s; z-index: 8000; }
        #off-screen.active { opacity: 1; pointer-events: all; }
        .power-circle {
            width: 80px; height: 80px; border-radius: 50%; border: 2px solid #333;
            display: flex; align-items: center; justify-content: center; color: white;
            cursor: pointer; transition: 0.3s; margin-top: 40px;
        }
        .power-circle:hover { border-color: white; box-shadow: 0 0 30px rgba(255,255,255,0.2); }

        /* LOCK SCREEN */
        #lock-screen {
            background-size: cover; background-position: center; 
            transition: transform 0.8s cubic-bezier(0.7, 0, 0.3, 1); z-index: 5000;
        }
        #lock-screen::before { content:''; position: absolute; inset: 0; background: rgba(0,0,0,0.3); }
        #lock-screen.unlocked { transform: translateY(-100%); }
        
        .lock-content {
            position: relative; z-index: 2; text-align: center;
            background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            padding: 50px 80px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        /* NOTIFICATIONS */
        #toast {
            position: fixed; top: 30px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: rgba(29, 29, 31, 0.95); color: white; backdrop-filter: blur(10px);
            padding: 16px 32px; border-radius: 50px; font-weight: 500; font-size: 14px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); z-index: 2000;
            display: flex; align-items: center; gap: 12px;
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #toast.show { transform: translateX(-50%) translateY(0); }

        /* ==========================================================================
           6. CONTENT MODULES
           ========================================================================== */
        
        /* WELCOME DASHBOARD (V34 Style) */
        .hero-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white; border-radius: var(--radius-lg); padding: 40px;
            position: relative; overflow: hidden; margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(0, 94, 99, 0.3);
        }
        .hero-pattern {
            position: absolute; right: -50px; bottom: -50px; width: 300px; height: 300px;
            fill: rgba(255,255,255,0.08); transform: rotate(-15deg);
        }
        
        .dashboard-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-box { text-align: center; padding: 25px 15px; }
        .stat-val { font-size: 28px; font-weight: 700; color: var(--primary); margin-bottom: 5px; }
        .stat-lbl { font-size: 11px; text-transform: uppercase; color: var(--tx-dim); font-weight: 700; letter-spacing: 1px; }

        /* MEDIA GRID */
        .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 25px; }
        .poster-card {
            border-radius: 12px; overflow: hidden; position: relative; cursor: pointer;
            transition: 0.3s; box-shadow: var(--shadow-sm); aspect-ratio: 2/3;
        }
        .poster-card img { width: 100%; height: 100%; object-fit: cover; }
        .poster-card:hover { transform: translateY(-8px); box-shadow: var(--shadow-lg); }
        .poster-info {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px 10px 10px 10px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            color: white; font-size: 13px; font-weight: 600; opacity: 0; transition: 0.3s;
        }
        .poster-card:hover .poster-info { opacity: 1; }

        /* CHAT */
        .chat-container { display: flex; flex-direction: column; height: 600px; padding: 0 !important; }
        .chat-history {
            flex: 1; padding: 25px; overflow-y: auto; background: var(--bg-input);
            display: flex; flex-direction: column; gap: 15px;
        }
        .chat-bubble {
            max-width: 80%; padding: 12px 18px; border-radius: 18px; font-size: 14px; line-height: 1.5;
            box-shadow: var(--shadow-sm); position: relative;
        }
        .chat-bubble.bot { align-self: flex-start; background: var(--bg-card); color: var(--tx-main); border-bottom-left-radius: 4px; }
        .chat-bubble.user { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 4px; }
        
        /* RESPONSIVE */
        @media (max-width: 1024px) {
            :root { --nav-w: 0px; }
            #sidebar { display: none; }
            .dashboard-grid { grid-template-columns: 1fr; }
            #header { padding: 0 20px; }
            .page { padding: 20px 20px 100px 20px; }
            .hero-card { padding: 25px; }
        }
    </style>
</head>
<body>

<svg style="display: none;">
    <symbol id="i-home" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></symbol>
    <symbol id="i-movie" viewBox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></symbol>
    <symbol id="i-game" viewBox="0 0 24 24"><path d="M20 6H4V4h16v2zM7 18h2v-2H7v2zm0-4h2v-2H7v2zm4 4h2v-2h-2v2zm0-4h2v-2h-2v2zm4 4h2v-2h-2v2zm0-4h2v-2h-2v2zM4 20h16v-8H4v8zM4 8v2h16V8H4z"/></symbol>
    <symbol id="i-chat" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></symbol>
    <symbol id="i-cog" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0 .59-.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.04.24.24.41.48.41h3.84c.24 0 .43-.17.47-.41l.36-2.54c.59-.24 1.13-.57 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.08-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></symbol>
    <symbol id="i-plane" viewBox="0 0 24 24"><path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></symbol>
    <symbol id="i-light" viewBox="0 0 24 24"><path d="M9 21c7.5 0 13.5-6 13.5-13.5 0-.5-.03-1.01-.08-1.5-.78 1.05-1.9 1.83-3.21 2.16-3.56.9-7.25-1.35-8.15-4.91-.33-1.31.45-2.43 1.5-3.21-.49-.05-1-.08-1.5-.08C3.6 0-2.4 6 9 21z"/></symbol>
    <symbol id="i-bell" viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></symbol>
    <symbol id="i-power" viewBox="0 0 24 24"><path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/></symbol>
</svg>

<div id="boot-screen" class="overlay"></div>

<div id="off-screen" class="overlay">
    <div id="off-logo" style="width:60px; height:60px; margin-bottom:20px;"></div>
    <h2 class="f-serif" style="color:#666;">Goodbye</h2>
    <div class="power-circle" onclick="SYS.boot(true)">
        <svg style="width:32px; height:32px; fill:currentColor"><use href="#i-power"></use></svg>
    </div>
</div>

<div id="lock-screen" class="overlay">
    <div class="lock-content">
        <div id="lock-logo" style="width:80px; height:80px; margin:0 auto 15px auto;"></div>
        <h1 class="f-serif" id="lock-title">Airline</h1>
        <div class="f-mono" style="opacity:0.7; font-size:12px; letter-spacing:3px; margin-bottom:30px;">V40 SYSTEM READY</div>
        <button class="btn btn-primary" onclick="SYS.unlock()" style="border-radius:100px; padding:0 40px;">Tap to Start</button>
    </div>
</div>

<div id="toast">
    <svg><use href="#i-bell"></use></svg>
    <span id="toast-msg">Notification</span>
</div>

<div id="app">
    
    <nav id="sidebar">
        <div class="brand">
            <div class="brand-logo" id="sb-logo"></div>
            <span class="brand-text" id="sb-title">Airline</span>
        </div>
        
        <div class="nav-list">
            <div class="label" style="padding:0 20px;">Entertainment</div>
            <div class="nav-item" onclick="NAV.go('p-movies', this)"><svg><use href="#i-movie"></use></svg> <span>Cinema</span></div>
            <div class="nav-item" onclick="NAV.go('p-games', this)"><svg><use href="#i-game"></use></svg> <span>Arcade</span></div>
            
            <div class="label" style="padding:20px 20px 0 20px;">Concierge</div>
            <div class="nav-item" onclick="NAV.go('p-chat', this)"><svg><use href="#i-chat"></use></svg> <span>Assistant</span></div>
            
            <div class="label" style="padding:20px 20px 0 20px;">System</div>
            <div class="nav-item" onclick="NAV.go('p-settings', this)"><svg><use href="#i-cog"></use></svg> <span>Settings</span></div>
            <div class="nav-item" style="color:#ef4444;" onclick="SYS.shutdown()"><svg><use href="#i-power"></use></svg> <span>Turn Off</span></div>
        </div>
    </nav>

    <main id="stage">
        
        <header id="header">
            <div class="f-mono" style="color:var(--tx-dim); font-size:14px;" id="clock">12:00</div>
            
            <div class="route-pill">
                <span class="f-mono" style="font-weight:700;" id="hdr-from">HKG</span>
                <svg style="width:14px; height:14px; fill:var(--primary); transform:rotate(90deg);"><use href="#i-plane"></use></svg>
                <span class="f-mono" style="font-weight:700;" id="hdr-to">LHR</span>
            </div>
        </header>

        <div id="viewport">

            <div id="p-welcome" class="page active">
                <div class="hero-card">
                    <svg class="hero-pattern"><use href="#i-plane"></use></svg>
                    <div class="f-serif" style="font-size:36px; margin-bottom:10px;">Welcome Aboard</div>
                    <div class="f-mono" style="opacity:0.8; font-size:14px;">PASSENGER / SEAT 42A</div>
                    <div style="margin-top:30px;">
                        <button class="btn" style="background:rgba(255,255,255,0.2); backdrop-filter:blur(5px); color:white;" onclick="NAV.go('p-movies')">Explore Entertainment</button>
                    </div>
                </div>

                <div class="card" style="padding:0; height:280px;">
                    <canvas id="sim-canvas" style="width:100%; height:100%; display:block;"></canvas>
                    <div class="abs-fill" style="padding:25px; display:flex; flex-direction:column; justify-content:space-between; pointer-events:none;">
                        <div style="align-self:flex-end; color:white; text-align:right;">
                            <div class="f-mono" style="font-size:28px;">580</div>
                            <div class="f-mono" style="font-size:10px; opacity:0.8;">MPH GROUND SPEED</div>
                        </div>
                        <div style="color:white;">
                            <div class="f-mono" style="font-size:28px;">38,000</div>
                            <div class="f-mono" style="font-size:10px; opacity:0.8;">FT ALTITUDE</div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card stat-box">
                        <div class="stat-val">7:42</div>
                        <div class="stat-lbl">Time to Arrival</div>
                    </div>
                    <div class="card stat-box">
                        <div class="stat-val">22Â°C</div>
                        <div class="stat-lbl">Cabin Temp</div>
                    </div>
                    <div class="card stat-box">
                        <div class="stat-val">Dinner</div>
                        <div class="stat-lbl">Service Status</div>
                    </div>
                </div>
            </div>

            <div id="p-movies" class="page">
                <h2 class="f-serif">Cinema Selection</h2>
                <div class="media-grid" id="movie-list">
                    </div>
            </div>

            <div id="p-games" class="page">
                <h2 class="f-serif">Arcade</h2>
                <div class="flex gap-2" style="margin-bottom:20px;">
                    <button class="btn btn-primary" onclick="GAME.start('snake')">Snake</button>
                    <button class="btn btn-sec" onclick="GAME.start('breakout')">Breakout</button>
                </div>
                <div style="background:#0F172A; border-radius:16px; border:4px solid #1E293B; height:450px; position:relative; overflow:hidden;">
                    <canvas id="game-cvs"></canvas>
                    <div id="game-ui" class="abs-fill flex-c flex-col" style="background:rgba(0,0,0,0.8); color:white;">
                        <h3 style="letter-spacing:2px;">PRESS GAME TO START</h3>
                        <p class="f-mono" style="font-size:12px; opacity:0.6;">ARROWS TO MOVE</p>
                    </div>
                </div>
            </div>

            <div id="p-chat" class="page">
                <div class="card chat-container">
                    <div class="chat-history" id="chat-feed">
                        <div class="chat-bubble bot">
                            Welcome, Mr. Anderson. How can I assist you today? You can ask for drinks, WiFi, or duty free.
                        </div>
                    </div>
                    <div style="padding:20px; border-top:var(--border); background:var(--bg-card); display:flex; gap:12px;">
                        <input type="text" id="chat-in" class="input" placeholder="Type request..." onkeydown="if(event.key==='Enter')CHAT.send()">
                        <button class="btn btn-primary" onclick="CHAT.send()">SEND</button>
                    </div>
                </div>
            </div>

            <div id="p-settings" class="page">
                <h2 class="f-serif">System Configuration</h2>
                
                <div class="card">
                    <h3>Brand Identity</h3>
                    <div class="input-group">
                        <label class="label">Airline Name</label>
                        <input type="text" id="set-name" class="input">
                    </div>
                    
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                        <div class="file-upload">
                            <input type="file" accept="image/*" onchange="SET.prev(this,'logo')">
                            <svg style="width:24px;height:24px;margin-bottom:8px;"><use href="#i-cog"></use></svg>
                            <span style="font-size:12px; font-weight:600;">Upload Logo</span>
                        </div>
                        <div class="file-upload">
                            <input type="file" accept="image/*" onchange="SET.prev(this,'bg')">
                            <svg style="width:24px;height:24px;margin-bottom:8px;"><use href="#i-cog"></use></svg>
                            <span style="font-size:12px; font-weight:600;">Upload Wallpaper</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Route & Color</h3>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
                        <div>
                            <label class="label">Origin</label>
                            <input type="text" id="set-from" class="input">
                        </div>
                        <div>
                            <label class="label">Destination</label>
                            <input type="text" id="set-to" class="input">
                        </div>
                    </div>
                    <label class="label">Theme Color</label>
                    <input type="color" id="set-color" class="input" style="padding:2px; height:50px;">
                    
                    <div class="flex gap-2" style="margin-top:30px;">
                        <button class="btn btn-primary w-full" onclick="SET.save()">Save Configuration</button>
                        <button class="btn btn-danger" onclick="SET.reset()">Reset</button>
                    </div>
                </div>
            </div>

        </div> </main>

    <div id="bottom-bar">
        <button class="bar-btn" onclick="SYS.toggleTheme()">
            <svg><use href="#i-light"></use></svg>
            <span>Light</span>
        </button>
        
        <button class="bar-btn home active" onclick="NAV.go('p-welcome')">
            <svg><use href="#i-home"></use></svg>
            <span>Home</span>
        </button>
        
        <button class="bar-btn" onclick="SYS.callCrew()">
            <svg><use href="#i-bell"></use></svg>
            <span>Call</span>
        </button>
    </div>

</div>

<script>
/**
 * INFLIGHT OS V40 KERNEL
 * Handles Boot, Navigation, Persistence, Canvas Rendering, and Logic.
 */

// 1. CONFIGURATION & STATE
const DEFAULTS = {
    name: "Cathay Pacific",
    color: "#005E63", // Default CX Teal
    hue: 178,
    from: "HKG", to: "LHR",
    bg: "https://images.unsplash.com/photo-1542296332-2e44a99cfef9?q=80&w=2000",
    logo: null,
    movies: [
        {t:"Dune: Part Two", i:"https://image.tmdb.org/t/p/w500/1pdfLvkbY9ohJlCjQH2CZjjYVvJ.jpg"},
        {t:"Oppenheimer", i:"https://image.tmdb.org/t/p/w500/8Gxv8gSFCU0XGDykEGv7zR1n2ua.jpg"},
        {t:"Top Gun: Maverick", i:"https://image.tmdb.org/t/p/w500/62HCnUTziyWcpDaBO2i1DX17ljH.jpg"},
        {t:"The Batman", i:"https://image.tmdb.org/t/p/w500/74xTEgt7R36Fpooo50r9T25onhq.jpg"},
        {t:"Interstellar", i:"https://image.tmdb.org/t/p/w500/gEU2QniE6E77NI6lCU6MxlNBvIx.jpg"},
        {t:"Inception", i:"https://image.tmdb.org/t/p/w500/9gk7admal4ZLVD9NdWHtJ4Gwd06.jpg"}
    ]
};

let CFG = JSON.parse(localStorage.getItem('v40_os')) || DEFAULTS;

// 2. SYSTEM CONTROLLER
const SYS = {
    init: () => {
        SYS.bootSequence();
    },

    // Linux-style boot text animation
    bootSequence: () => {
        const s = document.getElementById('boot-screen');
        const logs = [
            "Mounting file system...",
            "Loading kernel V40.0.1...",
            "Initializing GPU (Canvas 2D)...",
            "Connecting to cabin bus...",
            "Starting CX UI Service...",
            "System Ready."
        ];
        
        let d = 0;
        logs.forEach((t, i) => {
            setTimeout(() => {
                s.innerHTML += `
                    <div class="boot-row">
                        <span class="boot-ts">[${(d/1000).toFixed(6)}]</span>
                        <span class="boot-ok">OK</span>
                        <span class="boot-msg">${t}</span>
                    </div>`;
                window.scrollTo(0, document.body.scrollHeight);
            }, d);
            d += Math.random() * 400 + 100;
        });

        setTimeout(() => {
            s.style.display = 'none';
            SYS.start();
        }, d + 600);
    },

    start: () => {
        SYS.applySettings();
        SIM.init(); // Start Flight Sim
        SYS.clock();
        
        // Render Movies
        const mg = document.getElementById('movie-list');
        mg.innerHTML = CFG.movies.map(m => `
            <div class="poster-card">
                <img src="${m.i}" loading="lazy">
                <div class="poster-info">${m.t}</div>
            </div>
        `).join('');

        document.getElementById('app').classList.add('booted');
    },

    // Applies CSS variables and user text
    applySettings: () => {
        document.documentElement.style.setProperty('--primary', CFG.color);
        
        // Update Text
        ['sb-title', 'lock-title'].forEach(id => document.getElementById(id).innerText = CFG.name);
        document.getElementById('hdr-from').innerText = CFG.from;
        document.getElementById('hdr-to').innerText = CFG.to;
        
        // Update Backgrounds & Logos
        document.getElementById('lock-screen').style.backgroundImage = `url('${CFG.bg}')`;
        const logoHTML = CFG.logo 
            ? `<img src="${CFG.logo}" style="width:100%;height:100%;object-fit:contain;">`
            : `<svg style="width:30px;fill:var(--primary)"><use href="#i-plane"></use></svg>`;
        
        ['sb-logo', 'lock-logo', 'off-logo'].forEach(id => document.getElementById(id).innerHTML = logoHTML);

        // Update Input Fields
        document.getElementById('set-name').value = CFG.name;
        document.getElementById('set-from').value = CFG.from;
        document.getElementById('set-to').value = CFG.to;
        document.getElementById('set-color').value = CFG.color;
    },

    unlock: () => {
        document.getElementById('lock-screen').classList.add('unlocked');
        setTimeout(SIM.resize, 500); // Fix canvas size after unlock
    },

    toggleTheme: () => {
        document.body.classList.toggle('dark-mode');
        SYS.toast(document.body.classList.contains('dark-mode') ? "Reading Light Off" : "Reading Light On");
    },

    callCrew: () => {
        SYS.toast("Crew has been notified. Please wait.");
    },

    toast: (msg) => {
        const t = document.getElementById('toast');
        const m = document.getElementById('toast-msg');
        m.innerText = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    },

    shutdown: () => {
        document.getElementById('off-screen').classList.add('active');
    },
    
    boot: (reload = false) => {
        if(reload) location.reload();
    },

    clock: () => {
        setInterval(() => {
            const d = new Date();
            document.getElementById('clock').innerText = d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        }, 1000);
    }
};

// 3. NAVIGATION ENGINE
const NAV = {
    go: (pid, btn = null) => {
        // Handle Sidebar State
        if(btn && btn.classList.contains('nav-item')) {
            document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
            btn.classList.add('active');
        }
        
        // Handle Bottom Bar State
        const homeBtn = document.querySelector('.bar-btn.home');
        if(pid === 'p-welcome') homeBtn.classList.add('active');
        else homeBtn.classList.remove('active');

        // Page Transition
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pid).classList.add('active');

        // Resize Canvas triggers
        if(pid === 'p-games') setTimeout(GAME.resize, 100);
    }
};

// 4. SETTINGS & IO
const SET = {
    prev: (inp, type) => {
        if(inp.files[0]) {
            const r = new FileReader();
            r.onload = e => {
                if(type === 'logo') CFG.logo = e.target.result;
                if(type === 'bg') CFG.bg = e.target.result;
            };
            r.readAsDataURL(inp.files[0]);
        }
    },
    save: () => {
        CFG.name = document.getElementById('set-name').value;
        CFG.from = document.getElementById('set-from').value;
        CFG.to = document.getElementById('set-to').value;
        CFG.color = document.getElementById('set-color').value;
        localStorage.setItem('v40_os', JSON.stringify(CFG));
        location.reload();
    },
    reset: () => {
        localStorage.removeItem('v40_os');
        location.reload();
    }
};

// 5. FLIGHT SIMULATOR (CANVAS)
const SIM = {
    ctx: null, cvs: null,
    init: () => {
        SIM.cvs = document.getElementById('sim-canvas');
        SIM.ctx = SIM.cvs.getContext('2d');
        window.addEventListener('resize', SIM.resize);
        SIM.resize();
        SIM.loop();
    },
    resize: () => {
        if(!SIM.cvs) return;
        SIM.cvs.width = SIM.cvs.parentElement.offsetWidth;
        SIM.cvs.height = SIM.cvs.parentElement.offsetHeight;
    },
    loop: () => {
        const c = SIM.ctx, w = SIM.cvs.width, h = SIM.cvs.height;
        const t = Date.now() * 0.0005;

        // Gradient Sky
        const g = c.createLinearGradient(0,0,0,h);
        g.addColorStop(0, "#0F172A"); g.addColorStop(1, "#334155");
        c.fillStyle = g; c.fillRect(0,0,w,h);

        // Animated Clouds
        c.fillStyle = "rgba(255,255,255,0.05)";
        for(let i=0; i<5; i++) {
            c.beginPath();
            let cx = (w*i*0.25 + t*30) % (w+200) - 100;
            let cy = h/2 + Math.sin(t+i)*40;
            c.arc(cx, cy, 60 + i*10, 0, Math.PI*2);
            c.fill();
        }

        // Flight Path Line
        c.strokeStyle = CFG.color; c.lineWidth = 3; 
        c.setLineDash([10, 10]); c.lineDashOffset = -t*50;
        c.beginPath();
        c.moveTo(0, h-80);
        c.bezierCurveTo(w/2, h-80, w/2, 50, w, 50);
        c.stroke();
        c.setLineDash([]);

        // The Plane
        const p = 0.5; // Center
        // Bezier Point Calculation (Simplified for center bobbing)
        const px = w/2; 
        const py = (h-80)*(1-p)*(1-p) + 50*p*p + 2*(1-p)*p*(h/2-15); // Rough approx
        
        c.save();
        c.translate(px, py + Math.sin(t*2)*10);
        c.rotate(-0.1); // Slight ascent angle
        
        // Draw Plane
        c.fillStyle = "white";
        c.beginPath(); c.moveTo(20,0); c.lineTo(-10,10); c.lineTo(-10,-10); c.fill();
        
        // Pulse Effect
        c.strokeStyle = `rgba(255,255,255,${Math.abs(Math.sin(t*3))})`;
        c.beginPath(); c.arc(0,0, 30, 0, Math.PI*2); c.stroke();
        
        c.restore();

        requestAnimationFrame(SIM.loop);
    }
};

// 6. ARCADE ENGINE
const GAME = {
    id: null,
    resize: () => {
        const c = document.getElementById('game-cvs');
        c.width = c.parentElement.offsetWidth;
        c.height = c.parentElement.offsetHeight;
    },
    start: (g) => {
        document.getElementById('game-ui').style.display = 'none';
        if(GAME.id) cancelAnimationFrame(GAME.id);
        const c = document.getElementById('game-cvs');
        const x = c.getContext('2d');
        GAME.resize();
        
        if(g === 'snake') GAME.snake(c, x);
        if(g === 'breakout') GAME.breakout(c, x);
    },
    snake: (c, x) => {
        let s=[{x:5,y:5}], d={x:1,y:0}, f={x:10,y:10}, lt=0, sc=0;
        document.onkeydown=e=>{
            const k=e.key;
            if(k=='ArrowUp'&&d.y!=1)d={x:0,y:-1};if(k=='ArrowDown'&&d.y!=-1)d={x:0,y:1};
            if(k=='ArrowLeft'&&d.x!=1)d={x:-1,y:0};if(k=='ArrowRight'&&d.x!=-1)d={x:1,y:0};
        };
        const loop = t => {
            if(t-lt>100) {
                lt=t;
                const h={x:s[0].x+d.x, y:s[0].y+d.y};
                // Wall Wrap
                if(h.x<0)h.x=Math.floor(c.width/20)-1; if(h.x>=c.width/20)h.x=0;
                if(h.y<0)h.y=Math.floor(c.height/20)-1; if(h.y>=c.height/20)h.y=0;
                
                // Self Hit
                if(s.some(seg=>seg.x===h.x&&seg.y===h.y)) { s=[{x:5,y:5}]; sc=0; }
                
                s.unshift(h);
                if(h.x===f.x && h.y===f.y) {
                    sc++;
                    f={x:Math.floor(Math.random()*(c.width/20)), y:Math.floor(Math.random()*(c.height/20))};
                } else s.pop();

                x.fillStyle="#0F172A"; x.fillRect(0,0,c.width,c.height);
                x.fillStyle=CFG.color; s.forEach(p=>x.fillRect(p.x*20,p.y*20,18,18));
                x.fillStyle="#ef4444"; x.fillRect(f.x*20,f.y*20,18,18);
                x.fillStyle="white"; x.font="20px monospace"; x.fillText("SCORE: "+sc, 20, 30);
            }
            GAME.id = requestAnimationFrame(loop);
        }; loop(0);
    },
    breakout: (c, x) => {
        let b={x:c.width/2,y:c.height/2,dx:4,dy:-4}, p={x:c.width/2-50,w:100}, br=[];
        const cols=8, rows=5;
        for(let i=0;i<cols*rows;i++) br.push({x:(i%cols)*(c.width/cols), y:Math.floor(i/cols)*25+40, a:1});
        
        document.onkeydown=e=>{if(e.key=='ArrowLeft')p.x-=40;if(e.key=='ArrowRight')p.x+=40;};
        
        const loop = () => {
            x.fillStyle="#0F172A"; x.fillRect(0,0,c.width,c.height);
            b.x+=b.dx; b.y+=b.dy;

            // Walls
            if(b.x<0||b.x>c.width) b.dx*=-1;
            if(b.y<0) b.dy*=-1;
            if(b.y>c.height) { b.x=c.width/2; b.y=c.height/2; b.dy=-4; } // Reset

            // Paddle
            if(b.y>c.height-30 && b.x>p.x && b.x<p.x+p.w) {
                b.dy*=-1;
                b.dx = 8 * ((b.x-(p.x+p.w/2))/p.w); // Angle control
            }

            // Bricks
            br.forEach(k=>{
                if(k.a && b.x>k.x && b.x<k.x+(c.width/cols)-5 && b.y>k.y && b.y<k.y+20) {
                    b.dy*=-1; k.a=0;
                }
            });

            // Draw
            x.fillStyle="white"; x.beginPath(); x.arc(b.x,b.y,6,0,7); x.fill();
            x.fillStyle=CFG.color; x.fillRect(p.x,c.height-20,p.w,10);
            br.forEach(k=>{ if(k.a) {
                x.fillStyle = `hsl(${CFG.hue}, 60%, ${50 + (k.y/2)}%)`;
                x.fillRect(k.x+2,k.y+2, (c.width/cols)-4, 21); 
            }});
            
            GAME.id = requestAnimationFrame(loop);
        }; loop();
    }
};

// 7. CHAT LOGIC
const CHAT = {
    send: () => {
        const i = document.getElementById('chat-in');
        const v = i.value.trim(); if(!v)return;
        const b = document.getElementById('chat-feed');
        
        // User Msg
        b.innerHTML += `<div class="chat-bubble user">${v}</div>`;
        i.value=''; b.scrollTop=b.scrollHeight;
        
        // Bot Reply Sim
        setTimeout(() => {
            let r = "I've received your request.";
            const l = v.toLowerCase();
            if(l.includes('drink') || l.includes('water') || l.includes('wine')) r = "I'll bring the beverage cart to seat 42A shortly.";
            else if(l.includes('wifi')) r = "To connect, use network 'Cathay_Air' and enter code CX888.";
            else if(l.includes('food') || l.includes('meal')) r = "Dinner service will begin in approximately 45 minutes.";
            else if(l.includes('map')) r = "We are currently cruising at 38,000ft. Check the Home tab for details.";
            
            b.innerHTML += `<div class="chat-bubble bot">${r}</div>`;
            b.scrollTop=b.scrollHeight;
        }, 800);
    }
};

window.onload = SYS.init;
</script>
</body>
</html>
