<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IFE_ULTIMATE_V3</title>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;800&display=swap" rel="stylesheet">

<style>
  :root { --pry: #006564; --sec: #c6a87c; --bg: #0a0a0a; --sur: #141414; --txt: #e0e0e0; }
  body { margin: 0; background: var(--bg); color: var(--txt); font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }
  
  /* Layout */
  .app { display: flex; height: 100vh; }
  .sidebar { width: 80px; background: #000; border-right: 1px solid #222; display: flex; flex-direction: column; align-items: center; padding: 20px 0; z-index: 100; }
  .logo { width: 50px; height: 50px; object-fit: contain; margin-bottom: 40px; }
  .nav-item { width: 50px; height: 50px; border-radius: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #666; cursor: pointer; margin-bottom: 10px; transition: .2s; }
  .nav-item:hover, .nav-item.active { background: var(--pry); color: #fff; box-shadow: 0 0 15px var(--pry); }
  .nav-item i { font-size: 20px; margin-bottom: 4px; }
  .nav-item span { font-size: 8px; text-transform: uppercase; font-weight: 700; }

  .main { flex: 1; position: relative; display: flex; flex-direction: column; background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%); }
  
  /* Header & Stats */
  .header { height: 70px; border-bottom: 1px solid #222; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); }
  .flight-info { font-weight: 800; font-size: 20px; color: var(--sec); letter-spacing: 1px; }
  .stats-bar { display: flex; gap: 20px; font-size: 12px; color: #888; }
  .stat-box { background: rgba(255,255,255,0.05); padding: 5px 12px; border-radius: 20px; display: flex; gap: 8px; align-items: center; border: 1px solid #333; }
  .stat-box b { color: #fff; }

  /* Ticker */
  .ticker-wrap { background: var(--pry); overflow: hidden; height: 30px; line-height: 30px; color: #fff; font-size: 12px; font-weight: 600; white-space: nowrap; display: none; }
  .ticker-move { display: inline-block; animation: tick 20s linear infinite; padding-left: 100%; }
  @keyframes tick { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

  /* Views */
  .view { display: none; padding: 30px; height: 100%; overflow-y: auto; box-sizing: border-box; animation: fadeIn 0.4s; }
  .view.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* Map View */
  .map-container { width: 100%; height: 400px; background: #0d0d0d; border-radius: 15px; border: 1px solid #333; position: relative; overflow: hidden; margin-top: 20px; }
  .world-map { width: 100%; height: 100%; object-fit: cover; opacity: 0.4; }
  .route-line { position: absolute; top: 50%; left: 10%; width: 80%; height: 2px; background: #444; }
  .plane-icon { position: absolute; top: 46%; left: 10%; font-size: 24px; color: var(--sec); transition: left 1s linear; transform: rotate(90deg); text-shadow: 0 0 10px var(--sec); }
  .loc-dot { position: absolute; top: 49%; width: 8px; height: 8px; background: #fff; border-radius: 50%; }
  
  /* Grid & Cards */
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
  .card { background: var(--sur); border-radius: 8px; overflow: hidden; border: 1px solid #333; cursor: pointer; transition: .2s; }
  .card:hover { transform: scale(1.03); border-color: var(--sec); }
  .card img { width: 100%; height: 240px; object-fit: cover; }
  .card-info { padding: 12px; }
  .card-title { font-weight: 700; font-size: 14px; margin-bottom: 5px; white-space: nowrap; overflow: hidden; }
  .card-sub { font-size: 11px; color: #666; }

  /* Admin Panel */
  .admin-overlay { position: fixed; top: 0; right: -400px; width: 350px; height: 100%; background: #111; border-left: 1px solid var(--sec); transition: 0.3s; z-index: 999; padding: 20px; box-shadow: -10px 0 50px #000; overflow-y: auto; }
  .admin-overlay.open { right: 0; }
  .adm-group { margin-bottom: 15px; background: #1a1a1a; padding: 15px; border-radius: 8px; border: 1px solid #333; }
  .adm-group h4 { margin: 0 0 10px 0; color: var(--sec); font-size: 12px; text-transform: uppercase; }
  .inp-row { margin-bottom: 8px; }
  .inp-row label { display: block; font-size: 10px; color: #888; margin-bottom: 3px; }
  input, select, textarea { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 8px; border-radius: 4px; box-sizing: border-box; }
  .btn { width: 100%; padding: 10px; background: var(--pry); border: none; color: #fff; font-weight: 700; cursor: pointer; margin-top: 5px; border-radius: 4px; }
  .btn.red { background: #600; }
  
  /* Crew Calls */
  .call-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #300; border-radius: 4px; margin-bottom: 5px; animation: flash 2s infinite; }
  @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
  
  /* Video Player */
  .video-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1000; display: none; }
  .close-vid { position: absolute; top: 20px; right: 20px; font-size: 30px; cursor: pointer; color: #fff; z-index: 1001; }
  iframe { width: 100%; height: 100%; border: none; }
</style>
</head>
<body>

<div class="app">
  <div class="sidebar">
    <img id="ui_logo" class="logo" src="">
    <div class="nav-item active" onclick="nav('home', this)"><i class="fas fa-home"></i><span>Home</span></div>
    <div class="nav-item" onclick="nav('map', this)"><i class="fas fa-map-marked-alt"></i><span>Map</span></div>
    <div class="nav-item" onclick="nav('watch', this)"><i class="fas fa-film"></i><span>Watch</span></div>
    <div class="nav-item" onclick="nav('service', this)"><i class="fas fa-concierge-bell"></i><span>Crew</span></div>
    <div style="margin-top:auto;" class="nav-item" onclick="toggleAdmin()"><i class="fas fa-cog"></i><span>Admin</span></div>
  </div>

  <div class="main">
    <div class="header">
      <div class="flight-info" id="ui_fn">FLIGHT 000</div>
      <div class="stats-bar">
        <div class="stat-box"><i class="fas fa-plane"></i> <span id="ui_route">ORG - DST</span></div>
        <div class="stat-box"><i class="fas fa-tachometer-alt"></i> <b id="ui_spd">0</b> km/h</div>
        <div class="stat-box"><i class="fas fa-clock"></i> <b id="ui_rem">00:00</b></div>
      </div>
    </div>
    
    <div class="ticker-wrap" id="ticker_area">
      <div class="ticker-move" id="ui_msg">Captain: Welcome aboard.</div>
    </div>

    <div id="home" class="view active">
      <h1 style="font-size: 40px; margin-bottom: 5px;">Welcome Aboard</h1>
      <p style="color: #888; font-size: 18px;" id="ui_airline">Airline Name</p>
      
      <div style="display:flex; gap:20px; margin-top:40px;">
        <div style="flex:1; background:linear-gradient(45deg, #111, #222); padding:25px; border-radius:15px; border-left:4px solid var(--sec);">
          <div style="color:#666; font-size:12px;">OUTSIDE TEMP</div>
          <div style="font-size:32px;">-54&deg;C</div>
        </div>
        <div style="flex:1; background:linear-gradient(45deg, #111, #222); padding:25px; border-radius:15px; border-left:4px solid var(--pry);">
          <div style="color:#666; font-size:12px;">ALTITUDE</div>
          <div style="font-size:32px;">38,000 ft</div>
        </div>
      </div>
    </div>

    <div id="map" class="view">
      <h2>Flight Tracker</h2>
      <div class="map-container">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/World_map_blank_without_borders.svg/2000px-World_map_blank_without_borders.svg.png" class="world-map">
        <div class="route-line"></div>
        <div class="loc-dot" style="left:10%"></div> <div class="loc-dot" style="left:90%"></div> <i class="fas fa-plane plane-icon" id="plane_icon"></i>
      </div>
      <div style="display:flex; justify-content:space-between; margin-top:10px; color:#888; font-size:14px;">
        <span id="map_org">ORIGIN</span>
        <span id="map_dst">DESTINATION</span>
      </div>
    </div>

    <div id="watch" class="view">
      <h2>Entertainment</h2>
      <div class="grid" id="media_grid"></div>
    </div>

    <div id="service" class="view">
      <h2>Cabin Service</h2>
      <div style="max-width:400px;">
        <p style="color:#888">Need assistance? Tap the bell below to alert the crew.</p>
        <button class="btn" style="height:60px; font-size:18px; margin-bottom:20px;" onclick="callCrew('General Assistance')">
          <i class="fas fa-bell"></i> CALL ATTENDANT
        </button>
        <button class="btn" style="background:#333;" onclick="callCrew('Medical Emergency')">
          <i class="fas fa-first-aid"></i> MEDICAL HELP
        </button>
        <div id="req_status" style="margin-top:20px; color:var(--sec); display:none;">
          <i class="fas fa-check-circle"></i> Request Sent. Crew is on the way.
        </div>
      </div>
    </div>

  </div>
</div>

<div class="admin-overlay" id="admin_pnl">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
    <h2 style="margin:0;">Flight Control</h2>
    <i class="fas fa-times" style="cursor:pointer" onclick="toggleAdmin()"></i>
  </div>
  
  <div class="adm-group">
    <h4>Flight Details</h4>
    <div class="inp-row"><label>Airline Name</label><input id="s_al" value="CATHAY PACIFIC"></div>
    <div class="inp-row"><label>Flight Number</label><input id="s_fn" value="CX 882"></div>
    <div class="inp-row"><label>Origin</label><input id="s_og" value="HKG"></div>
    <div class="inp-row"><label>Destination</label><input id="s_ds" value="LHR"></div>
    <div class="inp-row"><label>Logo URL</label><input id="s_lg" value="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c2/Cathay_Pacific_logo.svg/1200px-Cathay_Pacific_logo.svg.png"></div>
    <button class="btn" onclick="saveSettings()">UPDATE DETAILS</button>
  </div>

  <div class="adm-group">
    <h4>Live Flight Status</h4>
    <div class="inp-row"><label>Flight Progress (%)</label><input type="range" id="s_prog" min="0" max="100" value="10" oninput="liveUpdate(this.value)"></div>
    <div class="inp-row"><label>Ground Speed (km/h)</label><input id="s_spd" value="945"></div>
    <div class="inp-row"><label>Time Remaining</label><input id="s_rem" value="04:20"></div>
    <button class="btn" onclick="saveStats()">UPDATE STATUS</button>
  </div>

  <div class="adm-group">
    <h4>Captain's Announcement</h4>
    <div class="inp-row"><textarea id="s_msg" rows="2">Welcome aboard flight 882.</textarea></div>
    <div class="inp-row"><label>Show Ticker?</label><select id="s_tic"><option value="true">Yes</option><option value="false">No</option></select></div>
    <button class="btn" onclick="saveMsg()">BROADCAST</button>
  </div>

  <div class="adm-group">
    <h4>Incoming Calls</h4>
    <div id="crew_list" style="font-size:12px; color:#aaa;">No active requests.</div>
    <button class="btn red" style="margin-top:10px;" onclick="clearReqs()">CLEAR ALL REQUESTS</button>
  </div>
</div>

<div class="video-modal" id="vid_mod">
  <div class="close-vid" onclick="closeVid()">&times;</div>
  <iframe id="vid_frame" allow="autoplay; fullscreen"></iframe>
</div>

<script>
// ===================================
// CONFIGURATION (Pre-Filled)
// ===================================
const config = {
  apiKey: "AIzaSyBiabDx61thAOm_A-_2x_mC9Nb9gArRCns",
  authDomain: "flight-ui.firebaseapp.com",
  projectId: "flight-ui",
  storageBucket: "flight-ui.firebasestorage.app",
  messagingSenderId: "507585547506",
  appId: "1:507585547506:web:a2f401ddda5055b59ed46b"
};

// Media Database (Default)
const MEDIA = [
  {t:"Top Gun: Maverick", i:"https://upload.wikimedia.org/wikipedia/en/1/13/Top_Gun_Maverick_Poster.jpg", u:"https://www.youtube.com/embed/qSqVVzvW13s?autoplay=1"},
  {t:"Interstellar", i:"https://upload.wikimedia.org/wikipedia/en/b/bc/Interstellar_film_poster.jpg", u:"https://www.youtube.com/embed/zSWdZVtXT7E?autoplay=1"},
  {t:"Nature Doc", i:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c8/Altja_j%C3%B5gi_Lahemaal.jpg/800px-Altja_j%C3%B5gi_Lahemaal.jpg", u:"https://www.youtube.com/embed/JkaxUblCGz0?autoplay=1"}
];

// App State
let db, ref;

function init() {
  try {
    firebase.initializeApp(config);
    db = firebase.database();
    ref = db.ref('flight_v3');
    listen();
    renderMedia();
  } catch (e) {
    console.error("Firebase Init Error", e);
    alert("System Offline: Check Console");
  }
}

// --- Navigation ---
function nav(id, el) {
  document.querySelectorAll('.view').forEach(d => d.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(d => d.classList.remove('active'));
  if(el) el.classList.add('active');
}

function toggleAdmin() {
  document.getElementById('admin_pnl').classList.toggle('open');
}

// --- Rendering ---
function renderMedia() {
  const g = document.getElementById('media_grid');
  g.innerHTML = MEDIA.map(m => `
    <div class="card" onclick="play('${m.u}')">
      <img src="${m.i}">
      <div class="card-info">
        <div class="card-title">${m.t}</div>
        <div class="card-sub">Movie</div>
      </div>
    </div>
  `).join('');
}

function play(url) {
  document.getElementById('vid_mod').style.display = 'block';
  document.getElementById('vid_frame').src = url;
}
function closeVid() {
  document.getElementById('vid_mod').style.display = 'none';
  document.getElementById('vid_frame').src = "";
}

// --- Firebase Listeners (The Magic) ---
function listen() {
  // 1. Settings (Airline, Logo, Route)
  ref.child('settings').on('value', snap => {
    const v = snap.val();
    if (!v) return;
    document.getElementById('ui_logo').src = v.lg;
    document.getElementById('ui_airline').innerText = v.al;
    document.getElementById('ui_fn').innerText = v.fn;
    document.getElementById('ui_route').innerText = v.og + " - " + v.ds;
    document.getElementById('map_org').innerText = v.og;
    document.getElementById('map_dst').innerText = v.ds;
    
    // Sync Admin Inputs
    document.getElementById('s_al').value = v.al;
    document.getElementById('s_fn').value = v.fn;
    document.getElementById('s_og').value = v.og;
    document.getElementById('s_ds').value = v.ds;
    document.getElementById('s_lg').value = v.lg;
  });

  // 2. Stats (Speed, Progress, Time)
  ref.child('stats').on('value', snap => {
    const v = snap.val();
    if(!v) return;
    document.getElementById('ui_spd').innerText = v.spd;
    document.getElementById('ui_rem').innerText = v.rem;
    
    // Update Map Plane Position
    const prog = v.prog || 0;
    const leftPos = 10 + (prog * 0.8); // Map from 10% to 90% CSS
    document.getElementById('plane_icon').style.left = leftPos + '%';
    document.getElementById('s_prog').value = prog; // Update Admin Slider
  });

  // 3. Messages (Ticker)
  ref.child('msg').on('value', snap => {
    const v = snap.val();
    if(!v) return;
    const box = document.getElementById('ticker_area');
    box.style.display = (v.show === 'true') ? 'block' : 'none';
    document.getElementById('ui_msg').innerText = v.txt;
  });

  // 4. Crew Requests
  ref.child('reqs').on('value', snap => {
    const list = document.getElementById('crew_list');
    const v = snap.val();
    if(!v) { list.innerHTML = "No active requests."; return; }
    
    list.innerHTML = Object.values(v).map(r => `
      <div class="call-item">
        <span><b>${r.seat}</b>: ${r.type}</span>
        <i class="fas fa-exclamation-circle"></i>
      </div>
    `).join('');
  });
}

// --- Admin Actions ---
function saveSettings() {
  ref.child('settings').set({
    al: document.getElementById('s_al').value,
    fn: document.getElementById('s_fn').value,
    og: document.getElementById('s_og').value,
    ds: document.getElementById('s_ds').value,
    lg: document.getElementById('s_lg').value
  });
}

function saveStats() {
  ref.child('stats').set({
    spd: document.getElementById('s_spd').value,
    rem: document.getElementById('s_rem').value,
    prog: document.getElementById('s_prog').value
  });
}

function saveMsg() {
  ref.child('msg').set({
    txt: document.getElementById('s_msg').value,
    show: document.getElementById('s_tic').value
  });
}

function liveUpdate(val) {
  // Updates progress immediately as you drag slider
  ref.child('stats').update({ prog: val });
}

function clearReqs() {
  ref.child('reqs').remove();
}

// --- Passenger Actions ---
function callCrew(type) {
  ref.child('reqs').push({
    seat: "Seat 42A", // Hardcoded for demo
    type: type,
    time: Date.now()
  });
  const st = document.getElementById('req_status');
  st.style.display = 'block';
  setTimeout(() => st.style.display='none', 3000);
}

window.onload = init;
</script>
</body>
</html>
