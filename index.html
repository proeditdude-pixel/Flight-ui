<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CX_IFE_V8_PREMIUM</title>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
  /* --- CX PREMIUM THEME --- */
  :root {
    --cx-teal: #006564;  /* The signature Jade */
    --cx-dark: #1F2A2F;  /* Deep Slate */
    --cx-beige: #C3A676; /* Gold/Sand Accent */
    --bg: #0d0d0d;
    --card-bg: #1a1a1a;
    --txt: #f0f0f0;
  }

  body { margin: 0; background: var(--bg); color: var(--txt); font-family: 'Noto Sans HK', sans-serif; height: 100vh; overflow: hidden; display: flex; }

  /* --- SIDEBAR NAVIGATION --- */
  .sidebar {
    width: 80px; background: var(--cx-dark); display: flex; flex-direction: column; align-items: center; 
    border-right: 1px solid #333; z-index: 100;
  }
  .brand-box { height: 70px; display: flex; align-items: center; justify-content: center; width: 100%; background: var(--cx-teal); margin-bottom: 20px; }
  .brand-logo { color: #fff; font-size: 24px; } /* Using Icon for Logo */
  
  .nav-item {
    width: 100%; padding: 18px 0; display: flex; flex-direction: column; align-items: center;
    color: #888; cursor: pointer; transition: 0.2s; border-left: 3px solid transparent;
  }
  .nav-item i { font-size: 20px; margin-bottom: 5px; }
  .nav-item span { font-size: 9px; text-transform: uppercase; letter-spacing: 1px; }
  .nav-item:hover { color: #fff; background: rgba(255,255,255,0.05); }
  .nav-item.active { border-left-color: var(--cx-beige); color: var(--cx-beige); background: linear-gradient(90deg, rgba(195,166,118,0.1), transparent); }

  /* --- MAIN CONTENT --- */
  .main { flex: 1; display: flex; flex-direction: column; position: relative; background: radial-gradient(circle at top right, #2c3e45 0%, #0d0d0d 60%); }

  /* Header */
  .top-bar {
    height: 70px; padding: 0 30px; display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid rgba(255,255,255,0.1); background: rgba(13,13,13,0.8); backdrop-filter: blur(10px);
  }
  .flight-numb { font-size: 20px; font-weight: 300; letter-spacing: 1px; color: #fff; }
  .flight-route { font-size: 12px; color: var(--cx-beige); margin-top: 2px; text-transform: uppercase; font-weight: 700; }
  
  .status-cluster { display: flex; gap: 20px; }
  .stat-box { text-align: right; }
  .stat-box label { font-size: 9px; color: #888; display: block; text-transform: uppercase; }
  .stat-box val { font-size: 14px; font-weight: 500; color: #fff; font-variant-numeric: tabular-nums; }

  /* Views */
  .view-container { flex: 1; overflow-y: auto; padding: 30px; position: relative; }
  .view { display: none; animation: fadeIn 0.4s; }
  .view.active { display: block; }
  @keyframes fadeIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }

  h1 { font-weight: 300; color: var(--cx-beige); margin-bottom: 5px; }
  h2 { font-size: 16px; text-transform: uppercase; color: #666; margin-top: 0; margin-bottom: 20px; letter-spacing: 2px; }

  /* CARDS & GRID */
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
  .card { 
    background: var(--card-bg); border-radius: 4px; overflow: hidden; cursor: pointer; 
    transition: 0.3s; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
  .card img { width: 100%; height: 280px; object-fit: cover; opacity: 0.9; }
  .card-meta { padding: 12px; }
  .card-title { font-size: 14px; font-weight: 500; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .card-sub { font-size: 11px; color: var(--cx-beige); margin-top: 4px; text-transform: uppercase; }

  /* MAP (IMPROVED) */
  .map-container { 
    position: relative; width: 100%; height: 400px; background: #050505; 
    border-radius: 8px; overflow: hidden; border: 1px solid #333;
  }
  .map-bg { width: 100%; height: 100%; object-fit: cover; opacity: 0.4; }
  .flight-path-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
  .plane-icon { 
    position: absolute; top: 45%; font-size: 24px; color: var(--cx-beige); 
    transform: translate(-50%, -50%) rotate(90deg); filter: drop-shadow(0 0 8px var(--cx-beige));
    transition: left 1s linear;
  }

  /* DINING MENU */
  .menu-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #333; }
  .menu-item:last-child { border: none; }
  .dish-name { font-size: 15px; font-weight: 500; }
  .dish-desc { font-size: 12px; color: #888; margin-top: 4px; width: 80%; }
  .dish-tag { font-size: 10px; border: 1px solid var(--cx-teal); color: var(--cx-teal); padding: 2px 6px; border-radius: 2px; height: fit-content; }

  /* CHAT */
  .chat-box { height: 400px; background: rgba(0,0,0,0.3); border: 1px solid #333; border-radius: 8px; display: flex; flex-direction: column; }
  .msgs { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
  .msg { padding: 8px 12px; border-radius: 6px; background: #222; max-width: 80%; font-size: 13px; align-self: flex-start; }
  .msg.me { background: var(--cx-teal); align-self: flex-end; color: #fff; }
  .msg b { color: var(--cx-beige); font-size: 10px; display: block; margin-bottom: 2px; }
  .chat-ctrl { display: flex; padding: 10px; border-top: 1px solid #333; }
  .chat-ctrl input { flex: 1; background: #111; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 4px; }
  .chat-ctrl button { margin-left: 10px; background: var(--cx-beige); border: none; padding: 0 20px; font-weight: bold; cursor: pointer; color: #000; border-radius: 4px; }

  /* ADMIN PANEL (Slide Out) */
  .admin-panel {
    position: fixed; top: 0; right: -400px; width: 350px; height: 100%;
    background: #111; border-left: 1px solid var(--cx-teal); z-index: 999;
    padding: 20px; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: -10px 0 50px #000; overflow-y: auto;
  }
  .admin-panel.open { right: 0; }
  .adm-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
  .inp-row { margin-bottom: 15px; }
  .inp-row label { display: block; font-size: 10px; color: var(--cx-beige); margin-bottom: 5px; text-transform: uppercase; }
  input, select { width: 100%; background: #222; border: 1px solid #444; color: #fff; padding: 8px; box-sizing: border-box; font-family: inherit; }
  .btn { width: 100%; padding: 10px; background: var(--cx-teal); border: none; color: #fff; font-weight: bold; cursor: pointer; margin-top: 5px; }
  .btn.sec { background: #333; }

  /* UTILS */
  .vid-modal { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:2000; display:none; }
  .close-vid { position:absolute; top:20px; right:20px; color:#fff; font-size:30px; cursor:pointer; z-index:2001; }
  iframe { border:none; width:100%; height:100%; }

  /* MOBILE TWEAKS */
  @media (max-width: 768px) {
    body { flex-direction: column-reverse; }
    .sidebar { width: 100%; height: 60px; flex-direction: row; border-right: none; border-top: 1px solid #333; padding:0; justify-content: space-around; }
    .brand-box { display: none; }
    .nav-item { border-left: none; border-top: 3px solid transparent; padding: 0; justify-content: center; height: 100%; }
    .nav-item.active { border-top-color: var(--cx-beige); background: transparent; }
    .status-cluster { display: none; } /* Hide complicated stats on phone */
    .admin-panel { width: 100%; right: -100%; }
  }
</style>
</head>
<body>

<div class="sidebar">
  <div class="brand-box"><i class="fas fa-feather-alt brand-logo"></i></div>
  <div class="nav-item active" onclick="nav('home', this)"><i class="fas fa-home"></i><span>Home</span></div>
  <div class="nav-item" onclick="nav('watch', this)"><i class="fas fa-film"></i><span>Watch</span></div>
  <div class="nav-item" onclick="nav('map', this)"><i class="fas fa-map-marked-alt"></i><span>Map</span></div>
  <div class="nav-item" onclick="nav('dine', this)"><i class="fas fa-utensils"></i><span>Dine</span></div>
  <div class="nav-item" onclick="nav('chat', this)"><i class="fas fa-comments"></i><span>Crew</span></div>
  <div style="flex:1"></div>
  <div class="nav-item" onclick="toggleAdm()"><i class="fas fa-cog"></i><span>Set</span></div>
</div>

<div class="main">
  <div class="top-bar">
    <div>
      <div class="flight-numb" id="ui_fn">CX 882</div>
      <div class="flight-route"><span id="ui_og">HKG</span> <i class="fas fa-arrow-right" style="font-size:10px; margin:0 5px; opacity:0.5"></i> <span id="ui_ds">LAX</span></div>
    </div>
    <div class="status-cluster">
      <div class="stat-box"><label>Seat</label><val id="ui_seat">---</val></div>
      <div class="stat-box"><label>Speed</label><val id="ui_sp">0 <small>km/h</small></val></div>
      <div class="stat-box"><label>Arrival</label><val id="ui_rm">00:00</val></div>
    </div>
  </div>

  <div class="view-container">
    
    <div id="home" class="view active">
      <h1>Welcome Aboard</h1>
      <h2 id="ui_al">Cathay Pacific</h2>
      
      <div style="background: linear-gradient(to right, var(--cx-teal), #004544); padding: 30px; border-radius: 8px; color: #fff; display:flex; align-items:center; justify-content:space-between; margin-bottom:30px;">
        <div>
           <div style="text-transform:uppercase; font-size:10px; letter-spacing:2px; margin-bottom:10px;">Current Status</div>
           <div style="font-size:28px; font-weight:300;">Cruising Altitude</div>
           <div style="margin-top:5px; opacity:0.8;">Relax and enjoy our service.</div>
        </div>
        <div style="text-align:right;">
           <i class="fas fa-cloud-sun" style="font-size:40px; opacity:0.5"></i>
           <div style="margin-top:10px; font-size:20px;">-54&deg;C</div>
        </div>
      </div>

      <h2>Recommended for You</h2>
      <div class="grid" id="rec_grid"></div>
    </div>

    <div id="watch" class="view">
      <h1>StudioCX</h1>
      <h2>Latest Blockbusters</h2>
      <div class="grid" id="mov_grid"></div>
      <h2 style="margin-top:40px">Interactive Games</h2>
      <div class="grid" id="game_grid"></div>
    </div>

    <div id="map" class="view">
      <h1>Flight Path</h1>
      <h2 id="route_text">HKG to LAX</h2>
      <div class="map-container">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/World_map_blank_without_borders.svg/2000px-World_map_blank_without_borders.svg.png" class="map-bg">
        <svg class="flight-path-svg">
          <path d="M 100,200 Q 400,100 700,200" stroke="var(--cx-beige)" stroke-width="2" fill="none" stroke-dasharray="5,5" style="opacity:0.6" />
        </svg>
        <i class="fas fa-plane plane-icon" id="plane_icon" style="left:10%"></i>
      </div>
      <div style="display:flex; justify-content:space-between; margin-top:20px; background:#111; padding:20px; border-radius:4px;">
         <div><div style="color:#888; font-size:10px;">ALTITUDE</div><div style="font-size:18px;">38,000 ft</div></div>
         <div><div style="color:#888; font-size:10px;">HEADWIND</div><div style="font-size:18px;">24 km/h</div></div>
         <div><div style="color:#888; font-size:10px;">DIST REMAINING</div><div style="font-size:18px;">4,230 km</div></div>
      </div>
    </div>

    <div id="dine" class="view">
      <h1>Dining</h1>
      <h2>Business Class Menu</h2>
      <div style="background:#151515; padding:20px; border-radius:8px;">
        <div class="menu-item">
          <div>
            <div class="dish-name">Pan-fried Beef Tenderloin</div>
            <div class="dish-desc">Served with seasonal vegetables, roasted potatoes and red wine jus.</div>
          </div>
          <div class="dish-tag">DINNER</div>
        </div>
        <div class="menu-item">
          <div>
            <div class="dish-name">Wonton Noodle Soup</div>
            <div class="dish-desc">Egg noodles with shrimp and pork dumplings in a rich broth.</div>
          </div>
          <div class="dish-tag">SNACK</div>
        </div>
        <div class="menu-item">
          <div>
            <div class="dish-name">HÃ¤agen-Dazs Ice Cream</div>
            <div class="dish-desc">Vanilla, Chocolate, or Strawberry flavors available.</div>
          </div>
          <div class="dish-tag">DESSERT</div>
        </div>
      </div>
      <button class="btn" style="margin-top:20px; background:var(--cx-beige); color:#000;" onclick="callCrew('Ordering Food')">CALL ATTENDANT TO ORDER</button>
    </div>

    <div id="chat" class="view">
      <h1>Passenger & Crew Link</h1>
      <h2>Seat <span id="chat_seat_display">--</span></h2>
      <div class="chat-box">
        <div class="msgs" id="chat_msgs"></div>
        <div class="chat-ctrl">
          <input id="chat_in" placeholder="Type message...">
          <button onclick="sendMsg()">SEND</button>
        </div>
      </div>
      <div style="margin-top:20px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
        <button class="btn" onclick="callCrew('Requesting Water')"><i class="fas fa-glass-water"></i> WATER</button>
        <button class="btn" onclick="callCrew('Requesting Assistance')"><i class="fas fa-bell"></i> ASSIST</button>
      </div>
    </div>

  </div>
</div>

<div class="admin-panel" id="adm">
  <div class="adm-head">
    <span style="color:var(--cx-beige); font-weight:bold;">SETTINGS (GOD MODE)</span>
    <button onclick="toggleAdm()" style="background:transparent; border:none; color:#fff;">X</button>
  </div>
  
  <div class="inp-row">
    <label>My Seat (Auto-Assigned)</label>
    <input id="my_seat_in" readonly style="color:#888;">
  </div>
  
  <hr style="border-color:#333; margin:20px 0;">
  
  <div class="inp-row"><label>Airline Name</label><input id="s_al"></div>
  <div class="inp-row"><label>Flight #</label><input id="s_fn"></div>
  <div class="inp-row"><label>Origin</label><input id="s_og"></div>
  <div class="inp-row"><label>Destination</label><input id="s_ds"></div>
  
  <hr style="border-color:#333; margin:20px 0;">
  
  <div class="inp-row"><label>Progress %</label><input type="range" id="s_pr" min="0" max="100" oninput="live(this.value)"></div>
  <div class="inp-row"><label>Speed</label><input id="s_sp"></div>
  <div class="inp-row"><label>Time Remaining</label><input id="s_rm"></div>
  
  <button class="btn" onclick="saveData()">UPDATE FLIGHT DATA</button>
</div>

<div class="vid-modal" id="vid_modal">
  <div class="close-vid" onclick="closeVid()">&times;</div>
  <iframe id="vid_frame" allow="autoplay; fullscreen"></iframe>
</div>

<script>
const C = { apiKey: "AIzaSyBiabDx61thAOm_A-_2x_mC9Nb9gArRCns", authDomain: "flight-ui.firebaseapp.com", projectId: "flight-ui", appId: "1:507585547506:web:a2f401ddda5055b59ed46b" };

const DATA = {
  movies: [
    {t:"Top Gun: Maverick", g:"Action", i:"https://upload.wikimedia.org/wikipedia/en/1/13/Top_Gun_Maverick_Poster.jpg", u:"https://www.youtube.com/embed/qSqVVzvW13s?autoplay=1"},
    {t:"The Fabelmans", g:"Drama", i:"https://upload.wikimedia.org/wikipedia/en/2/23/The_Fabelmans_poster.jpg", u:"https://www.youtube.com/embed/D1G2iLSzOe8?autoplay=1"},
    {t:"Everything Everywhere", g:"Sci-Fi", i:"https://upload.wikimedia.org/wikipedia/en/1/1e/Everything_Everywhere_All_at_Once.jpg", u:"https://www.youtube.com/embed/wxN1T1uxQ2g?autoplay=1"}
  ],
  games: [
    {t:"2048", g:"Puzzle", i:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/2048_logo.svg/220px-2048_logo.svg.png", u:"https://play2048.co/"},
    {t:"Minecraft", g:"Adventure", i:"https://upload.wikimedia.org/wikipedia/en/5/51/Minecraft_cover.png", u:"https://classic.minecraft.net/"}
  ]
};

let db, ref, chatRef, presRef;
let mySeat = "";

function init(){
  try{
    firebase.initializeApp(C);
    db = firebase.database();
    ref = db.ref('v8_flight');
    chatRef = db.ref('v8_chat');
    presRef = db.ref('v8_presence');

    setupSeat();
    renderContent();
    listen();
  }catch(e){console.log(e)}
}

// SMART SEAT (Random + Auto Delete on disconnect)
function setupSeat(){
  let s = localStorage.getItem("v8_seat");
  if(s) checkSeat(s);
  else genSeat();
}
function genSeat(){
  let s = (Math.floor(Math.random()*60)+1) + ["A","C","D","G","H","K"][Math.floor(Math.random()*6)];
  checkSeat(s);
}
function checkSeat(s){
  presRef.child(s).once('value', snap=>{
    if(snap.exists() && snap.val().st === 'on'){
       console.log('Taken, retrying...'); genSeat(); // Retry if taken
    } else {
       mySeat = s;
       localStorage.setItem("v8_seat", s);
       document.getElementById('ui_seat').innerText = s;
       document.getElementById('chat_seat_display').innerText = s;
       document.getElementById('my_seat_in').value = s;
       
       // Presence Logic
       let me = presRef.child(s);
       me.set({st:'on', ts:Date.now()});
       me.onDisconnect().remove();
    }
  });
}

// LISTENERS
function listen(){
  ref.on('value', snap=>{
    let v = snap.val(); if(!v) return;
    // Info
    if(v.info) {
      document.getElementById('ui_fn').innerText = v.info.fn || "CX 882";
      document.getElementById('ui_al').innerText = v.info.al || "Cathay Pacific";
      document.getElementById('ui_og').innerText = v.info.og || "HKG";
      document.getElementById('ui_ds').innerText = v.info.ds || "LAX";
      document.getElementById('route_text').innerText = (v.info.og||"") + " TO " + (v.info.ds||"");
      
      // Admin Sync
      document.getElementById('s_fn').value = v.info.fn;
      document.getElementById('s_al').value = v.info.al;
      document.getElementById('s_og').value = v.info.og;
      document.getElementById('s_ds').value = v.info.ds;
    }
    // Status
    if(v.stat) {
      document.getElementById('ui_sp').innerText = v.stat.sp;
      document.getElementById('ui_rm').innerText = v.stat.rm;
      
      // Map
      let p = v.stat.pr || 0;
      // Calculate icon position on a slight curve
      document.getElementById('plane_icon').style.left = (10 + p*0.8) + "%";
      // Simple parallax effect for curve (optional complex math omitted for simplicity)
      
      // Admin Sync
      document.getElementById('s_sp').value = v.stat.sp;
      document.getElementById('s_rm').value = v.stat.rm;
      document.getElementById('s_pr').value = v.stat.pr;
    }
  });

  chatRef.limitToLast(20).on('child_added', snap=>{
    let v = snap.val();
    let box = document.getElementById('chat_msgs');
    let isMe = v.u === mySeat;
    box.innerHTML += `<div class="msg ${isMe?'me':''}"><b>${v.u}</b>${v.m}</div>`;
    box.scrollTop = box.scrollHeight;
  });
}

// RENDERING
function renderContent(){
  // Movies
  document.getElementById('mov_grid').innerHTML = DATA.movies.map(m=>`
    <div class="card" onclick="play('${m.u}')">
      <img src="${m.i}">
      <div class="card-meta"><div class="card-title">${m.t}</div><div class="card-sub">${m.g}</div></div>
    </div>
  `).join('');
  // Recs (Reuse movies)
  document.getElementById('rec_grid').innerHTML = DATA.movies.slice(0,2).map(m=>`
    <div class="card" onclick="play('${m.u}')">
      <img src="${m.i}">
      <div class="card-meta"><div class="card-title">${m.t}</div><div class="card-sub">RECOMMENDED</div></div>
    </div>
  `).join('');
  // Games
  document.getElementById('game_grid').innerHTML = DATA.games.map(g=>`
    <div class="card" onclick="play('${g.u}')">
      <img src="${g.i}">
      <div class="card-meta"><div class="card-title">${g.t}</div><div class="card-sub">${g.g}</div></div>
    </div>
  `).join('');
}

// ACTIONS
function nav(id, el){
  document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));
  el.classList.add('active');
}

function toggleAdm(){ document.getElementById('adm').classList.toggle('open'); }

function saveData(){
  ref.child('info').update({
    fn: document.getElementById('s_fn').value,
    al: document.getElementById('s_al').value,
    og: document.getElementById('s_og').value,
    ds: document.getElementById('s_ds').value
  });
  ref.child('stat').update({
    sp: document.getElementById('s_sp').value,
    rm: document.getElementById('s_rm').value,
    pr: document.getElementById('s_pr').value
  });
}
function live(v){ ref.child('stat').update({pr:v}); }

function sendMsg(){
  let i = document.getElementById('chat_in');
  if(!i.value) return;
  chatRef.push({u:mySeat, m:i.value});
  i.value = "";
}
function callCrew(reason){
  chatRef.push({u:mySeat, m:` [SERVICE REQUEST] ${reason}`});
  alert("Crew notified!");
}

function play(u){ document.getElementById('vid_modal').style.display='block'; document.getElementById('vid_frame').src=u; }
function closeVid(){ document.getElementById('vid_modal').style.display='none'; document.getElementById('vid_frame').src=""; }

window.onload = init;
</script>
</body>
</html>

