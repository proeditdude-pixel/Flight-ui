<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CX_IFE_V13_INFINITE</title>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@100;300;400;500;700&display=swap" rel="stylesheet">

<style>
  /* --- 1. DYNAMIC THEME ENGINE --- */
  :root {
    /* DEFAULT COLORS (Overwritten by Settings) */
    --primary: #006564;  /* Brand Color (Teal) */
    --accent: #C3A676;   /* Gold/Highlight */
    
    /* SYSTEM COLORS */
    --bg: #000000;
    --panel-dark: #0a0a0a;
    --panel-light: #141414;
    --txt: #ffffff;
    --txt-dim: #888888;
    --border: #333333;
    
    --font: 'Noto Sans HK', sans-serif;
  }

  * { box-sizing: border-box; user-select: none; }

  body { 
    margin: 0; background: var(--bg); color: var(--txt); 
    font-family: var(--font); height: 100vh; overflow: hidden; 
  }
  
  /* --- 2. WELCOME / STANDBY SCREEN --- */
  #welcome_layer {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: radial-gradient(circle at center, #1f1f1f 0%, #000000 100%);
    z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
  }
  #welcome_layer.off { 
    opacity: 0; transform: scale(1.1); visibility: hidden; pointer-events: none; 
  }
  
  .wel-logo-container {
    width: 140px; height: 140px; display: flex; align-items: center; justify-content: center;
    margin-bottom: 30px;
    filter: drop-shadow(0 0 30px rgba(255,255,255,0.15));
  }
  .wel-logo-img { width: 100%; height: 100%; object-fit: contain; }
  
  .wel-title { 
    font-size: 36px; font-weight: 300; letter-spacing: 4px; 
    text-transform: uppercase; color: #fff; text-align: center; margin-bottom: 10px;
  }
  .wel-seat { 
    font-size: 22px; color: var(--accent); margin-top: 5px; 
    font-weight: 500; letter-spacing: 2px; border: 1px solid var(--accent);
    padding: 5px 15px; border-radius: 50px;
  }
  .wel-hint { 
    margin-top: 60px; font-size: 11px; color: #555; 
    animation: pulse 3s infinite; text-transform: uppercase; letter-spacing: 3px; 
  }
  @keyframes pulse { 0%{opacity:0.3} 50%{opacity:1} 100%{opacity:0.3} }

  /* --- 3. MAIN APP LAYOUT --- */
  #app_container {
    display: flex; height: 100%; width: 100%; opacity: 0; 
    transition: opacity 1s ease 0.3s; transform: scale(0.98); pointer-events: none;
  }
  #app_container.on { opacity: 1; transform: scale(1); pointer-events: all; }

  #app_bg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-size: cover; background-position: center; opacity: 0.25; z-index: -1;
    transition: background-image 0.5s;
  }

  /* SIDEBAR NAVIGATION */
  .sidebar {
    width: 90px; background: rgba(10,10,10,0.95); border-right: 1px solid var(--border); 
    z-index: 100; display: flex; flex-direction: column; align-items: center; 
    backdrop-filter: blur(20px);
  }
  .logo-box { 
    width: 100%; padding: 25px 0; display: flex; justify-content: center; 
    background: var(--primary); margin-bottom: 10px; transition: background 0.5s; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  }
  .logo-img { width: 45px; height: 45px; object-fit: contain; filter: brightness(0) invert(1); }
  
  .nav-btn {
    width: 100%; padding: 22px 0; text-align: center; color: #666; cursor: pointer; 
    border-left: 3px solid transparent; transition: all 0.2s ease;
  }
  .nav-btn i { font-size: 22px; display: block; margin-bottom: 6px; }
  .nav-btn span { font-size: 9px; text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }
  .nav-btn:hover { color: #ccc; background: rgba(255,255,255,0.03); }
  .nav-btn.active { 
    color: var(--accent); border-left-color: var(--accent); 
    background: linear-gradient(90deg, rgba(255,255,255,0.08), transparent); 
    text-shadow: 0 0 10px rgba(0,0,0,0.5);
  }
  
  .pwr-btn { margin-top: auto; margin-bottom: 20px; color: #d63031; opacity: 0.7; }
  .pwr-btn:hover { opacity: 1; color: #ff7675; text-shadow: 0 0 10px #d63031; }

  /* MAIN CONTENT AREA */
  .main { flex: 1; display: flex; flex-direction: column; position: relative; }

  /* HEADER ROW */
  .header {
    height: 80px; display: flex; align-items: center; justify-content: space-between; padding: 0 50px;
    background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.0) 100%);
  }
  .route-disp { font-size: 26px; font-weight: 300; letter-spacing: 1px; }
  .route-disp b { font-weight: 600; color: var(--accent); margin: 0 5px; }
  
  /* VIEWPORT */
  .view-port { 
    flex: 1; position: relative; overflow-y: auto; overflow-x: hidden; 
    padding: 20px 50px 50px 50px; scroll-behavior: smooth;
  }
  .view { display: none; animation: fadeUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1); }
  .view.active { display: block; }
  @keyframes fadeUp { from{opacity:0; transform:translateY(30px)} to{opacity:1; transform:translateY(0)} }

  /* HEADINGS */
  h1 { font-weight: 300; font-size: 32px; color: var(--accent); margin: 0 0 10px 0; letter-spacing: 1px; }
  h2 { font-size: 14px; text-transform: uppercase; color: var(--txt-dim); margin-top: 5px; margin-bottom: 30px; letter-spacing: 2px; border-bottom: 1px solid #333; padding-bottom: 10px; display: inline-block; }

  /* --- HOME: 3D EARTH & STATS --- */
  .home-layout { display: flex; align-items: center; gap: 40px; height: 100%; }
  .globe-side { flex: 1; display: flex; justify-content: center; position: relative; }
  .globe-container {
    width: 320px; height: 320px; border-radius: 50%;
    background: #000; box-shadow: inset -40px -40px 100px rgba(0,0,0,0.9), 0 0 60px rgba(0,150,150,0.1);
    position: relative; overflow: hidden; border: 1px solid #333;
  }
  .earth-texture {
    width: 200%; height: 100%;
    background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Earthmap1000x500compac.jpg/1000px-Earthmap1000x500compac.jpg');
    background-size: cover; animation: spin 45s linear infinite; opacity: 0.9;
  }
  @keyframes spin { from{transform:translateX(0)} to{transform:translateX(-50%)} }
  .hero-plane {
    position: absolute; top: 50%; left: 50%; font-size: 48px; color: var(--accent);
    transform: translate(-50%, -50%) rotate(-45deg);
    text-shadow: 0 15px 30px rgba(0,0,0,1); z-index: 10;
  }

  .data-side { flex: 1; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .stat-card { 
    background: rgba(255,255,255,0.03); padding: 25px; border-radius: 12px; 
    border-top: 3px solid var(--primary); backdrop-filter: blur(5px);
  }
  .stat-val { font-size: 32px; font-weight: 300; margin-bottom: 5px; }
  .stat-label { font-size: 10px; text-transform: uppercase; color: #777; letter-spacing: 1px; }

  /* --- MAP PAGE --- */
  .map-wrapper { 
    width: 100%; height: 500px; border-radius: 16px; overflow: hidden; position: relative; 
    background: #0b1116; border: 1px solid #333; display: flex; justify-content: center; align-items: center;
  }
  .map-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.5; filter: contrast(1.2); }
  .route-line-bg { position: absolute; top: 50%; left: 10%; right: 10%; height: 2px; background: rgba(255,255,255,0.1); }
  .route-line-fill { position: absolute; top: 50%; left: 10%; height: 2px; background: var(--accent); width: 0%; transition: width 1s linear; box-shadow: 0 0 10px var(--accent); }
  .map-plane { 
    position: absolute; top: 50%; left: 10%; 
    font-size: 24px; color: #fff; transform: translate(-50%, -50%) rotate(90deg); 
    transition: left 1s linear; filter: drop-shadow(0 0 15px var(--accent));
  }
  .map-labels { position: absolute; top: 55%; width: 80%; left: 10%; display: flex; justify-content: space-between; font-size: 14px; font-weight: bold; color: #aaa; }

  /* --- MEDIA (MOVIES & GAMES) --- */
  .media-section-title { color: var(--accent); font-size: 18px; margin-top: 40px; margin-bottom: 15px; border-left: 3px solid var(--primary); padding-left: 10px; }
  .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 25px; }
  .media-card { 
    background: var(--panel-light); border-radius: 6px; overflow: hidden; cursor: pointer; 
    transition: all 0.3s ease; position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
    border: 1px solid transparent;
  }
  .media-card:hover { transform: translateY(-8px); border-color: var(--accent); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
  .media-card img { width: 100%; height: 240px; object-fit: cover; opacity: 0.85; transition: opacity 0.3s; }
  .media-card:hover img { opacity: 1; }
  .media-meta { padding: 15px; }
  .media-title { font-size: 13px; font-weight: 700; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .media-sub { font-size: 10px; color: var(--accent); margin-top: 6px; text-transform: uppercase; font-weight: 600; }

  /* --- DINING (FULL MENU) --- */
  .menu-category { margin-bottom: 40px; }
  .menu-cat-title { font-size: 24px; font-weight: 300; color: var(--accent); margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
  .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
  .menu-item { 
    display: flex; justify-content: space-between; padding: 20px; 
    background: rgba(255,255,255,0.03); border-radius: 8px; border: 1px solid transparent;
  }
  .menu-item:hover { border-color: var(--primary); background: rgba(255,255,255,0.05); }
  .dish-info h3 { margin: 0; font-size: 16px; font-weight: 500; color: #fff; }
  .dish-info p { margin: 5px 0 0 0; font-size: 12px; color: #888; line-height: 1.4; }
  .dish-tag { 
    font-size: 10px; border: 1px solid var(--primary); color: var(--primary); 
    padding: 4px 8px; border-radius: 4px; height: fit-content; font-weight: 700; 
  }

  /* --- CHAT --- */
  .chat-layout { display: flex; gap: 20px; height: 500px; }
  .chat-main { flex: 2; display: flex; flex-direction: column; background: rgba(0,0,0,0.3); border: 1px solid #333; border-radius: 12px; overflow: hidden; }
  .chat-sidebar { flex: 1; display: flex; flex-direction: column; gap: 10px; }
  
  .msgs { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
  .msg { padding: 10px 15px; border-radius: 8px; background: #222; max-width: 80%; font-size: 13px; align-self: flex-start; line-height: 1.4; }
  .msg.me { background: var(--primary); align-self: flex-end; color: #fff; border-bottom-right-radius: 2px; }
  .msg b { color: var(--accent); font-size: 10px; display: block; margin-bottom: 4px; text-transform: uppercase; }
  
  .chat-ctrl { display: flex; padding: 15px; border-top: 1px solid #333; background: #111; }
  .chat-ctrl input { flex: 1; background: #222; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 6px; outline: none; }
  .chat-ctrl input:focus { border-color: var(--accent); }
  .chat-ctrl button { margin-left: 10px; background: var(--accent); border: none; padding: 0 25px; font-weight: bold; cursor: pointer; color: #000; border-radius: 6px; }

  .service-btn {
    padding: 20px; background: #1a1a1a; border: 1px solid #333; color: #ccc; cursor: pointer;
    text-align: left; border-radius: 8px; transition: 0.2s; display: flex; align-items: center; gap: 15px;
  }
  .service-btn:hover { background: #222; border-color: var(--accent); color: #fff; }
  .service-btn i { font-size: 20px; color: var(--primary); }

  /* --- SETTINGS PANEL --- */
  .admin-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000;
    display: none; justify-content: center; align-items: center; backdrop-filter: blur(8px);
  }
  .admin-box { 
    width: 450px; background: #151515; padding: 40px; border-radius: 16px; 
    border: 1px solid var(--primary); height: 85vh; overflow-y: auto; 
    box-shadow: 0 0 50px rgba(0,0,0,0.8);
  }
  .inp { 
    width: 100%; background: #000; border: 1px solid #333; color: #fff; 
    padding: 12px; margin-bottom: 12px; box-sizing: border-box; border-radius: 4px; 
  }
  .inp:focus { border-color: var(--accent); outline: none; }
  
  .btn { width: 100%; padding: 15px; background: var(--primary); color: #fff; border: none; cursor: pointer; font-weight: bold; margin-top: 15px; border-radius: 6px; font-size: 14px; letter-spacing: 1px; }
  .btn:hover { filter: brightness(1.2); }
  
  .label-head { font-size:11px; color:var(--accent); margin-top:20px; margin-bottom: 5px; display:block; text-transform:uppercase; font-weight:bold; letter-spacing: 1px; }
  
  /* VIDEO MODAL */
  .vid-modal { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:3000; display:none; }
  .close-vid { position:absolute; top:30px; right:30px; color:#fff; font-size:40px; cursor:pointer; z-index:3001; background:rgba(0,0,0,0.5); width: 60px; height: 60px; text-align: center; line-height: 60px; border-radius:50%; transition:0.3s; }
  .close-vid:hover { background: var(--primary); }
  iframe { border:none; width:100%; height:100%; }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    #app_container { flex-direction: column-reverse; }
    .sidebar { width: 100%; height: 70px; flex-direction: row; justify-content: space-around; padding: 0; border-right: none; border-top: 1px solid #333; }
    .logo-box, .pwr-btn span { display: none; }
    .pwr-btn { margin: 0; padding: 0 20px; color: #d63031; }
    .nav-btn { border-left: none; border-top: 3px solid transparent; padding: 0; height: 100%; display: flex; flex-direction: column; justify-content: center; width: 100%; }
    .nav-btn.active { border-top-color: var(--accent); background: transparent; }
    .view-port { padding: 20px; }
    .header { padding: 0 20px; height: 60px; }
    .home-layout { flex-direction: column; }
    .menu-grid { grid-template-columns: 1fr; }
    .chat-layout { flex-direction: column; height: auto; }
  }
</style>
</head>
<body>

<div id="welcome_layer" onclick="powerOn()">
  <div class="wel-logo-container"><img id="wel_logo" class="wel-logo-img" src=""></div>
  <div class="wel-title" id="wel_txt">Welcome Onboard</div>
  <div class="wel-seat" id="wel_seat_disp">Seat --</div>
  <div class="wel-hint">Tap screen to Initialize System</div>
</div>

<div id="app_container">
  <div id="app_bg"></div>

  <div class="sidebar">
    <div class="logo-box"><img id="ui_logo" class="logo-img" src=""></div>
    <div class="nav-btn active" onclick="nav('home', this)"><i class="fas fa-globe-asia"></i><span>Flight</span></div>
    <div class="nav-btn" onclick="nav('map', this)"><i class="fas fa-map"></i><span>Map</span></div>
    <div class="nav-btn" onclick="nav('watch', this)"><i class="fas fa-play-circle"></i><span>Media</span></div>
    <div class="nav-btn" onclick="nav('dine', this)"><i class="fas fa-utensils"></i><span>Dine</span></div>
    <div class="nav-btn" onclick="nav('chat', this)"><i class="fas fa-comments"></i><span>Crew</span></div>
    <div class="nav-btn" onclick="openSet()"><i class="fas fa-cog"></i><span>Set</span></div>
    <div class="nav-btn pwr-btn" onclick="powerOff(event)"><i class="fas fa-power-off"></i><span>Off</span></div>
  </div>

  <div class="main">
    <div class="header">
      <div class="route-disp">
        <span id="ui_og">ORG</span> 
        <i class="fas fa-plane" style="font-size:16px; margin:0 15px; color:#666; transform: rotate(0deg);"></i> 
        <span id="ui_ds">DST</span>
      </div>
      <div style="text-align:right">
        <div style="font-size:11px; color:#888; letter-spacing:1px; margin-bottom:2px">TIME REMAINING</div>
        <div style="font-size:22px; font-weight:300; color:var(--accent)" id="ui_rem">--:--</div>
      </div>
    </div>

    <div class="view-port">
      
      <div id="home" class="view active">
        <h1>Flight Telemetry</h1>
        <h2>Real-time Data</h2>
        <div class="home-layout">
          <div class="globe-side">
            <div class="globe-container">
              <div class="earth-texture"></div>
              <i class="fas fa-plane hero-plane"></i>
            </div>
          </div>
          <div class="data-side">
            <div class="stat-card">
              <div class="stat-val">945 <small style="font-size:16px">km/h</small></div>
              <div class="stat-label">Ground Speed</div>
            </div>
            <div class="stat-card">
              <div class="stat-val">38,000 <small style="font-size:16px">ft</small></div>
              <div class="stat-label">Altitude</div>
            </div>
             <div class="stat-card">
              <div class="stat-val" id="ui_wea">22&deg;C</div>
              <div class="stat-label">Dest. Temp</div>
            </div>
            <div class="stat-card">
              <div class="stat-val" id="ui_dist">0 <small style="font-size:16px">km</small></div>
              <div class="stat-label">Distance to Go</div>
            </div>
            <div class="stat-card">
              <div class="stat-val">-54&deg;C</div>
              <div class="stat-label">Outside Air</div>
            </div>
            <div class="stat-card">
              <div class="stat-val">22 km/h</div>
              <div class="stat-label">Headwind</div>
            </div>
          </div>
        </div>
      </div>

      <div id="map" class="view">
        <h1>Live Tracking</h1>
        <h2>Global Positioning System</h2>
        <div class="map-wrapper">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/World_map_blank_without_borders.svg/2000px-World_map_blank_without_borders.svg.png" class="map-img">
          <div class="route-line-bg"></div>
          <div class="route-line-fill" id="map_line"></div>
          <i class="fas fa-plane map-plane" id="map_plane"></i>
          <div class="map-labels">
            <span id="map_og">ORG</span>
            <span id="map_ds">DST</span>
          </div>
        </div>
      </div>

      <div id="watch" class="view">
        <h1>StudioCX Entertainment</h1>
        <h2>Thousands of hours of content</h2>
        
        <div class="media-section-title">Latest Blockbusters</div>
        <div class="media-grid" id="mov_grid"></div>
        
        <div class="media-section-title">Interactive Games</div>
        <div class="media-grid" id="game_grid"></div>
      </div>

      <div id="dine" class="view">
        <h1>In-flight Dining</h1>
        <h2>A la Carte Menu</h2>
        
        <div class="menu-category">
          <div class="menu-cat-title">Starters</div>
          <div class="menu-grid">
             <div class="menu-item">
               <div class="dish-info"><h3>Smoked Salmon</h3><p>Served with crème fraîche and dill.</p></div>
               <div class="dish-tag">COLD</div>
             </div>
             <div class="menu-item">
               <div class="dish-info"><h3>Wild Mushroom Soup</h3><p>Truffle oil drizzle, crispy croutons.</p></div>
               <div class="dish-tag">HOT</div>
             </div>
          </div>
        </div>

        <div class="menu-category">
          <div class="menu-cat-title">Main Courses</div>
          <div class="menu-grid">
             <div class="menu-item">
               <div class="dish-info"><h3>Signature Beef Burger</h3><p>Wagyu patty, brioche bun, aged cheddar, bacon jam.</p></div>
               <div class="dish-tag">CHEF</div>
             </div>
             <div class="menu-item">
               <div class="dish-info"><h3>Wonton Noodle Soup</h3><p>Fresh shrimp dumplings, egg noodles, supreme broth.</p></div>
               <div class="dish-tag">HKG</div>
             </div>
             <div class="menu-item">
               <div class="dish-info"><h3>Roasted Chicken Breast</h3><p>Lemon herb sauce, mashed potatoes, vegetables.</p></div>
               <div class="dish-tag">WEST</div>
             </div>
             <div class="menu-item">
               <div class="dish-info"><h3>Vegetable Curry</h3><p>Basmati rice, naan bread, mango chutney.</p></div>
               <div class="dish-tag">VEG</div>
             </div>
          </div>
        </div>

        <div class="menu-category">
          <div class="menu-cat-title">Dessert</div>
          <div class="menu-grid">
             <div class="menu-item">
               <div class="dish-info"><h3>Matcha Cheesecake</h3><p>Red bean paste, japanese green tea.</p></div>
               <div class="dish-tag">SWT</div>
             </div>
             <div class="menu-item">
               <div class="dish-info"><h3>Seasonal Fruit Plate</h3><p>Selection of fresh cut fruits.</p></div>
               <div class="dish-tag">FRT</div>
             </div>
          </div>
        </div>

        <button class="btn" onclick="callCrew('Ordering Food')">CALL ATTENDANT TO ORDER</button>
      </div>

      <div id="chat" class="view">
        <h1>Service & Communication</h1>
        <h2>Connected as <span id="chat_seat_display" style="color:#fff">--</span></h2>
        
        <div class="chat-layout">
          <div class="chat-main">
            <div class="msgs" id="chat_msgs"></div>
            <div class="chat-ctrl">
              <input id="chat_in" placeholder="Type a message to crew or passengers...">
              <button onclick="sendMsg()">SEND</button>
            </div>
          </div>
          <div class="chat-sidebar">
            <div class="service-btn" onclick="callCrew('Water Request')">
              <i class="fas fa-glass-water"></i>
              <div><b>Request Water</b><div style="font-size:10px">Bottle or Glass</div></div>
            </div>
            <div class="service-btn" onclick="callCrew('Coffee Request')">
              <i class="fas fa-coffee"></i>
              <div><b>Request Coffee</b><div style="font-size:10px">Hot beverages</div></div>
            </div>
            <div class="service-btn" onclick="callCrew('Blanket Request')">
              <i class="fas fa-bed"></i>
              <div><b>Request Blanket</b><div style="font-size:10px">Comfort Items</div></div>
            </div>
            <div class="service-btn" onclick="callCrew('General Assistance')">
              <i class="fas fa-bell"></i>
              <div><b>Call Attendant</b><div style="font-size:10px">General Help</div></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<div class="admin-overlay" id="adm">
  <div class="admin-box">
    <h3 style="margin-top:0; color:var(--accent); font-size:24px; border-bottom:1px solid #333; padding-bottom:15px">DESIGN STUDIO</h3>
    
    <span class="label-head">Theme Engine</span>
    <div style="display:flex; gap:15px; margin-bottom:15px;">
      <div style="flex:1">
        <label style="font-size:10px; color:#888;">BRAND COLOR</label>
        <input type="color" id="s_c1" class="inp" style="height:45px; padding:0; cursor:pointer">
      </div>
      <div style="flex:1">
        <label style="font-size:10px; color:#888;">ACCENT COLOR</label>
        <input type="color" id="s_c2" class="inp" style="height:45px; padding:0; cursor:pointer">
      </div>
    </div>

    <span class="label-head">Welcome Screen</span>
    <input class="inp" id="s_wtxt" placeholder="Welcome Text (e.g. Welcome Onboard)">
    
    <span class="label-head">Branding Assets</span>
    <input class="inp" id="s_lg" placeholder="Logo URL (PNG transparent)">
    <input class="inp" id="s_bg" placeholder="Background Image URL">
    
    <span class="label-head">Flight Route</span>
    <div style="display:flex; gap:10px;">
      <input class="inp" id="s_og" placeholder="ORG (e.g. HKG)">
      <input class="inp" id="s_ds" placeholder="DST (e.g. LHR)">
    </div>
    
    <span class="label-head">Simulation Parameters</span>
    <input class="inp" type="number" id="s_dur" placeholder="Duration (min)">
    
    <button class="btn" onclick="saveSettings()">APPLY CHANGES & RESTART</button>
    <button class="btn" style="background:#222; margin-top:10px; color:#999" onclick="closeSet()">CANCEL</button>
  </div>
</div>

<div class="vid-modal" id="vid_modal">
  <div class="close-vid" onclick="closeVid()">&times;</div>
  <iframe id="vid_frame" allow="autoplay; fullscreen"></iframe>
</div>

<script>
// --- CONFIGURATION ---
const C = { apiKey: "AIzaSyBiabDx61thAOm_A-_2x_mC9Nb9gArRCns", authDomain: "flight-ui.firebaseapp.com", projectId: "flight-ui", appId: "1:507585547506:web:a2f401ddda5055b59ed46b" };

const MEDIA = {
  movies: [
    {t:"Top Gun: Maverick", g:"Action", i:"https://upload.wikimedia.org/wikipedia/en/1/13/Top_Gun_Maverick_Poster.jpg", u:"https://www.youtube.com/embed/qSqVVzvW13s?autoplay=1"},
    {t:"Avatar: Way of Water", g:"Sci-Fi", i:"https://upload.wikimedia.org/wikipedia/en/5/54/Avatar_The_Way_of_Water_poster.jpg", u:"https://www.youtube.com/embed/d9MyqF3bPhI?autoplay=1"},
    {t:"The Fabelmans", g:"Drama", i:"https://upload.wikimedia.org/wikipedia/en/2/23/The_Fabelmans_poster.jpg", u:"https://www.youtube.com/embed/D1G2iLSzOe8?autoplay=1"},
    {t:"Everything Everywhere", g:"Adventure", i:"https://upload.wikimedia.org/wikipedia/en/1/1e/Everything_Everywhere_All_at_Once.jpg", u:"https://www.youtube.com/embed/wxN1T1uxQ2g?autoplay=1"}
  ],
  games: [
    {t:"2048", g:"Puzzle", i:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/2048_logo.svg/220px-2048_logo.svg.png", u:"https://play2048.co/"},
    {t:"Minecraft Classic", g:"Sandbox", i:"https://upload.wikimedia.org/wikipedia/en/5/51/Minecraft_cover.png", u:"https://classic.minecraft.net/"}
  ]
};

const DEF = {
  lg: "https://upload.wikimedia.org/wikipedia/en/thumb/9/96/Cathay_Pacific_logo.svg/1200px-Cathay_Pacific_logo.svg.png",
  bg: "https://images.unsplash.com/photo-1542296332-2e44a996aa0b?q=80&w=2000&auto=format&fit=crop",
  c1: "#006564", // Default Teal
  c2: "#C3A676", // Default Sand
  wt: "Welcome Onboard"
};

let db, ref, chatRef, simInterval, mySeat="";

// --- INITIALIZATION ---
function init(){
  try {
    firebase.initializeApp(C);
    db = firebase.database();
    ref = db.ref('v13_flight');
    chatRef = db.ref('v13_chat');
    
    assignSeat();
    renderMedia();
    
    // Listen for Settings Changes
    ref.on('value', snap => { if(snap.val()) updateUI(snap.val()); });
    
    // Listen for Chat
    chatRef.limitToLast(25).on('child_added', snap=>{
      let v = snap.val(); 
      let b = document.getElementById('chat_msgs');
      let isMe = v.u === mySeat;
      b.innerHTML += `<div class="msg ${isMe?'me':''}"><b>${v.u}</b>${v.m}</div>`;
      b.scrollTop = b.scrollHeight;
    });

  } catch(e) { console.error("Firebase Error:", e); }
}

// --- THEME & UI UPDATE LOGIC ---
function updateUI(d){
  // 1. Dynamic CSS Variables
  let root = document.documentElement;
  root.style.setProperty('--primary', d.c1 || DEF.c1);
  root.style.setProperty('--accent', d.c2 || DEF.c2);
  
  // 2. Images & Text
  document.getElementById('ui_logo').src = d.lg || DEF.lg;
  document.getElementById('wel_logo').src = d.lg || DEF.lg; 
  document.getElementById('wel_txt').innerText = d.wt || DEF.wt; 
  document.getElementById('app_bg').style.backgroundImage = `url('${d.bg || DEF.bg}')`;
  
  // 3. Flight Text
  document.getElementById('ui_og').innerText = d.og || "HKG";
  document.getElementById('ui_ds').innerText = d.ds || "LHR";
  document.getElementById('map_og').innerText = d.og || "HKG";
  document.getElementById('map_ds').innerText = d.ds || "LHR";

  // 4. Update Settings Inputs (Sync)
  document.getElementById('s_c1').value = d.c1 || DEF.c1;
  document.getElementById('s_c2').value = d.c2 || DEF.c2;
  document.getElementById('s_wtxt').value = d.wt || DEF.wt;
  document.getElementById('s_lg').value = d.lg || "";
  document.getElementById('s_bg').value = d.bg || "";
  document.getElementById('s_og').value = d.og || "";
  document.getElementById('s_ds').value = d.ds || "";
  document.getElementById('s_dur').value = d.dur || 60;

  // 5. Restart Simulation
  if(d.start && d.dur) runSimulation(d.start, d.dur);
}

// --- FLIGHT SIMULATION ENGINE ---
function runSimulation(startTime, durationMins) {
  if(simInterval) clearInterval(simInterval);
  simInterval = setInterval(() => {
    let now = Date.now();
    let elapsed = now - startTime;
    let total = durationMins * 60 * 1000;
    
    let pct = (elapsed / total) * 100;
    if(pct < 0) pct = 0; if(pct > 100) pct = 100;

    // Map Movement
    document.getElementById('map_line').style.width = pct + "%";
    document.getElementById('map_plane').style.left = (10 + pct*0.8) + "%"; 
    
    // Time Calculation
    let minsLeft = Math.ceil((total - elapsed) / 60000);
    if(minsLeft < 0) minsLeft = 0;
    document.getElementById('ui_rem').innerText = `${Math.floor(minsLeft/60)}h ${minsLeft%60}m`;

    // Distance Calculation
    let distTotal = 9600; 
    let distLeft = Math.floor(distTotal * (1 - (pct/100)));
    document.getElementById('ui_dist').innerHTML = distLeft + " <small>km</small>";

    // Weather Logic
    if(pct > 80) document.getElementById('ui_wea').innerHTML = "12&deg;C <small>Rainy</small>";
    else document.getElementById('ui_wea').innerHTML = "24&deg;C <small>Sunny</small>";

  }, 1000);
}

// --- USER ACTIONS ---
function saveSettings(){
  let data = {
    c1: document.getElementById('s_c1').value,
    c2: document.getElementById('s_c2').value,
    wt: document.getElementById('s_wtxt').value || DEF.wt,
    lg: document.getElementById('s_lg').value || DEF.lg,
    bg: document.getElementById('s_bg').value || DEF.bg,
    og: document.getElementById('s_og').value || "HKG",
    ds: document.getElementById('s_ds').value || "LHR",
    dur: parseInt(document.getElementById('s_dur').value) || 60,
    start: Date.now()
  };
  ref.set(data);
  closeSet();
}

function assignSeat() {
  if(!localStorage.getItem("v13_seat")) {
    let s = (Math.floor(Math.random()*60)+1) + ["A","C","D","G","H","K"][Math.floor(Math.random()*6)];
    localStorage.setItem("v13_seat", s);
  }
  mySeat = localStorage.getItem("v13_seat");
  document.getElementById('wel_seat_disp').innerText = "Seat " + mySeat;
  document.getElementById('chat_seat_display').innerText = mySeat;
}

function renderMedia() {
  document.getElementById('mov_grid').innerHTML = MEDIA.movies.map(m=>`
    <div class="media-card" onclick="play('${m.u}')">
      <img src="${m.i}">
      <div class="media-meta"><div class="media-title">${m.t}</div><div class="media-sub">${m.g}</div></div>
    </div>`).join('');
    
  document.getElementById('game_grid').innerHTML = MEDIA.games.map(g=>`
    <div class="media-card" onclick="play('${g.u}')">
      <img src="${g.i}">
      <div class="media-meta"><div class="media-title">${g.t}</div><div class="media-sub">${g.g}</div></div>
    </div>`).join('');
}

function sendMsg(){
  let i = document.getElementById('chat_in');
  if(!i.value) return;
  chatRef.push({u:mySeat, m:i.value});
  i.value = "";
}

function callCrew(reason){
  chatRef.push({u:mySeat, m:` [SERVICE] Request: ${reason}`});
  alert("Crew has been notified of your request: " + reason);
}

// --- NAVIGATION & UTILS ---
function powerOn() { 
  document.getElementById('welcome_layer').classList.add('off'); 
  document.getElementById('app_container').classList.add('on'); 
}
function powerOff(e) { 
  e.stopPropagation(); 
  document.getElementById('app_container').classList.remove('on'); 
  document.getElementById('welcome_layer').classList.remove('off'); 
}
function nav(id, el){
  document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));
  el.classList.add('active');
}
function play(u){ document.getElementById('vid_modal').style.display='block'; document.getElementById('vid_frame').src=u; }
function closeVid(){ document.getElementById('vid_modal').style.display='none'; document.getElementById('vid_frame').src=""; }
function openSet(){ document.getElementById('adm').style.display = "flex"; }
function closeSet(){ document.getElementById('adm').style.display = "none"; }

window.onload = init;
</script>
</body>
</html>

